<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Intermediate Python - Concepts, Tools and Packaging: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Intermediate Python - Concepts, Tools and Packaging
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Intermediate Python - Concepts, Tools and Packaging
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intermediate Python - Concepts, Tools and Packaging
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-virtual-environments.html">1. Virtual Environments</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-creating-a-module.html">2. Creating A Module</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-class-objects.html">3. Class Objects</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-unit-testing.html">4. Unit Testing</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-extending-classes.html">5. Extending Classes with Inheritance</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-composition.html">6. Inheritance and Composition</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-static-code-analysis.html">7. Static Code Analysis</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-building-and-deploying.html">8. Building and Deploying a Package</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-virtual-environments"><p>Content from <a href="01-virtual-environments.html">Virtual Environments</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/01-virtual-environments.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a Virtual Environment? / Why use a Virtual Environment?</li>
<li>How do I create a Virtual Environment?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a new virtual environment using <code>uv</code>
</li>
<li>Push our new project to a gitlab repository.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-a-virtual-environment">What is a Virtual Environment?<a class="anchor" aria-label="anchor" href="#what-is-a-virtual-environment"></a>
</h2>
<hr class="half-width">
<p>A virtual environment is an isolated workspace where you can install
python packages and run python code without worrying about affecting the
tools, executables, and packages installed in either the global python
enviroment or in other projects.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>What is the difference between a “package manager” and a “virtual
environment”?</p>
<p>A package manager helps automate the process of installing,
upgrading, and removing software packages. Each package is usually built
on top of several other packages, and rely on the methods and objects
provided. However as projects are upgraded and changed over time, the
available methods and objects can change. A package manager solves the
complex “dependncy web” created by the packages you would like to
install and finds the version of all required packages that meets your
needs.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="why-would-i-use-a-virtual-environment">Why Would I use a Virtual Environment?<a class="anchor" aria-label="anchor" href="#why-would-i-use-a-virtual-environment"></a>
</h2>
<hr class="half-width">
<p>If you are only ever working on your own projects, or on scripts for
a single project, it’s absoultely fine to never worry about virtual
environments. But as soon as you start creating new projects working on
code written by other people, it becomes incredibly important to know
that the code that you are running is running on the exact same versions
of libraries.</p>
<p>In the past, it was notoriously difficult to manage envrironments
with python:</p>
<p><a href="https://xkcd.com/1987/" class="external-link">XKCD comic</a></p>
<p>There have been a number of attempts to create a “one size fits all”
approach to virtual environments and dependency management:</p>
<ul>
<li>venv</li>
<li>virtualenv</li>
<li>conda</li>
<li>pipenv</li>
<li>pyenv</li>
<li>poetry</li>
</ul>
<p>We’re going to use <a href="https://docs.astral.sh/uv/" class="external-link">uv</a> for
the purposes of this workwhop. UV is a another tool that promises to
slot in to the needs of environment and dependency management, however
there are a few key elements that set it apart:</p>
<ol style="list-style-type: decimal">
<li>It is written in Rust, which gives it a significant speed
improvement over pip and conda.</li>
<li>It works with the <code>pyproject.toml</code> and
<code>uv.lock</code> files, which allow for human and computer readable
project files.</li>
<li>It can install and manage it’s own python versions.</li>
<li>It works as a drop-in replacement for pip, eliminating the need to
learn new commands.</li>
</ol></section><section><h2 class="section-heading" id="creating-a-project-with-uv">Creating a project with UV<a class="anchor" aria-label="anchor" href="#creating-a-project-with-uv"></a>
</h2>
<hr class="half-width">
<p>Before the workshop, you should have had a chance to install and
check that your python and uv executables were working. If you have not
yet had a chance to do this, please refer to the <a href="">setup</a>
page for this workshop.</p>
<p>We’re going to start with a totally blank project, so let’s create a
directory called “textanalysis-tool”. Navigate to this directory in your
command line. Let’s quickly make sure we have UV installed and working
by typing <code>uv --version</code>. You should see something like the
following (the exact version number might be different):</p>
<figure><img src="./fig/01-virtual-environments/uv_version.PNG" alt='Checking that uv is installed by running "uv --version"' class="figure mx-auto d-block"><div class="figcaption">Checking that UV is installed</div>
</figure><p>We can start off with a new project with UV by running the command
<code>uv init</code>. This will automatically create a couple files for
us:</p>
<figure><img src="./fig/01-virtual-environments/uv_init.PNG" alt='Files created by running "uv init"' class="figure mx-auto d-block"><div class="figcaption">Files created by “uv init”</div>
</figure><p>We can see that there are four files created by this command:</p>
<ul>
<li>
<code>.python-version</code>: This file is used to optionally
specify the Python version for the project.</li>
<li>
<code>main.py</code>: This is the main Python script for the
project.</li>
<li>
<code>pyproject.toml</code>: This file is used to manage project
dependencies and settings.</li>
<li>
<code>README.md</code>: This file contains human written information
about the project.</li>
</ul>
<p>If we take a look at the <code>pyproject.toml</code> file, we can see
that it contains some basic information about our project in a fairly
readable format:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">[project]</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"textanalysis-tool-{my-name}"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">"Add your description here"</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="dt">readme</span> <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="dt">requires-python</span> <span class="op">=</span> <span class="st">"&gt;=3.13"</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="dt">dependencies</span> <span class="op">=</span> <span class="op">[]</span></span></code></pre>
</div>
<p>The <code>requires-python</code> field may vary depending on the
exact version of python you’re working with.</p>
<div class="important">
<p>Make sure to change <code>{my-name}</code> in the <code>name</code>
field to something unique, such as your GitHub username. This is
important later when we upload our package to TestPyPI, as package names
must be unique.</p>
</div>
</section><section><h2 class="section-heading" id="creating-a-virtual-environment">Creating a Virtual Environment<a class="anchor" aria-label="anchor" href="#creating-a-virtual-environment"></a>
</h2>
<hr class="half-width">
<p>To create a virtual environment with UV, we can use the
<code>uv venv</code> command. This will create a new virtual environment
in a directory called <code>.venv</code> within our project folder.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">uv</span> venv</span></code></pre>
</div>
<p>Before we activate our environment, let’s quickly check the location
of the current python executable you are using is by starting a python
interpreter with the <code>python</code> keyword, and running the
following comands:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>sys.executable</span></code></pre>
</div>
<p>You can type <code>exit</code> to leave the python interpreter</p>
<p>You should see the path to the location of the python executable on
your machine. Now let’s activate our environment. The exact command will
depend on your operating system, but if you look above the python code
to the output of the <code>uv venv</code> command, you should see the
correct command.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">source</span> .venv/bin/activate</span></code></pre>
</div>
<p>If this command works properly, you should see that before your
prompt is now some text in parenthesis:</p>
<pre><code>(textanalysis-tool) D:\Documents\Projects\textanalysis-tool&gt;</code></pre>
<p>Let’s start up the python interpreter again and check the location of
our executable:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>sys.executable</span></code></pre>
</div>
<p>What you should now see is that the executable is located in the
.venv/Scripts directory of our project:</p>
<pre><code>(textanalysis-tool) D:\Documents\Projects\textanalysis-tool&gt;python
Python 3.13.7 (tags/v3.13.7:bcee1c3, Aug 14 2025, 14:15:11) [MSC v.1944 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.executable
'D:\\Documents\\Projects\\textanalysis-tool\\.venv\\Scripts\\python.exe'</code></pre>
<p>Exit out of the interpreter and deactivate the virtual environment
with <code>deactivate</code>.</p>
</section><section><h2 class="section-heading" id="git-commit-and-pushing-to-our-repository">Git Commit and Pushing to our Repository<a class="anchor" aria-label="anchor" href="#git-commit-and-pushing-to-our-repository"></a>
</h2>
<hr class="half-width">
<p>We also want to create another file called <code>.gitignore</code>,
to control which files are added to our git repository. It’s generally a
good idea to create this file early on, and update it whenever you
notice files or folders you want to explicitly prevent from being added
to the repository.</p>
<p>We can create a gitignore from the command line with
<code>type nul &gt; .gitignore</code> (Windows), or
<code>touch .gitignore</code> (Mac/Linux). There are several pre-written
gitignores that we can optionally use, but for this project we’ll
maintain our own. Open up the file and add the following lines to
it:</p>
<pre><code>__pycache__/
dist/
*.egg-info/</code></pre>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>A commonly used gitignore is the Python.gitignore maintained by
GitHub. You can find it <a href="https://github.com/github/gitignore/blob/main/Python.gitignore" class="external-link">here</a>.</p>
</div>
</div>
</div>
</div>
<p>Next, let’s set up a repository on GitHub to store our code. We’ll
make an entirely blank repository, with the same name as our project:
“textanalysis-tool”.</p>
<figure><img src="./fig/01-virtual-environments/new-repo.PNG" alt="The Github interface for creating a new repository" class="figure mx-auto d-block"><div class="figcaption">Creating a new repository</div>
</figure><div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>We’re creating the files on our local machine first, then the remote
repository. There’s no reason you can’t go the other way around,
creating the remote repository then cloning it to your local
machine.</p>
</div>
</div>
</div>
<p>First, we’ll initialize a git repository locally, making an intial
commit with the files that uv generated:</p>
<pre><code>git init
git add .gitignore .python-version README.md main.py pyproject.toml
git commit -m "Initial commit"</code></pre>
<p>Then we’ll follow the directions for creating a new repository:</p>
<pre><code>git remote add origin https://github.com/{username}/textanalysis-tool.git
git branch -M main
git push -u origin main</code></pre>
<p>If all goes well, we’ll see our code appear in the new
repository:</p>
<figure><img src="./fig/01-virtual-environments/first-commit.PNG" alt="The Github interface showing the initial commit" class="figure mx-auto d-block"><div class="figcaption">New repository with initial commit</div>
</figure><p>And with that, we’re ready to start writing our tool!</p>
<div id="discussion-topic" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="discussion-topic" class="callout-inner">
<h3 class="callout-title">Discussion Topic</h3>
<div class="callout-content">
<p>TBD</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Setting up a virtual environment is useful for managing project
dependencies.</li>
<li>Using <code>uv</code> simplifies the process of creating and
managing virtual environments.</li>
<li>There are several options other than <code>uv</code> for managing
virtual environments, such as <code>venv</code> and
<code>conda</code>.</li>
<li>It’s important to version control your project from the start,
including a <code>.gitignore</code> file.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-creating-a-module"><p>Content from <a href="02-creating-a-module.html">Creating A Module</a></p>
<hr>
<p>Last updated on 2025-09-11 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/02-creating-a-module.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="project-organization">Project Organization<a class="anchor" aria-label="anchor" href="#project-organization"></a>
</h2>
<hr class="half-width">
<p>In order to keep our project organized, we’ll start by creating some
directories to put our code in. So that we can keep the “source” code of
our project separate from other aspects, we’ll start by creating a
directory called “src”. In this directory, we’ll create a second
directory with the name of our module, in this case “textanalysis-tool”.
We can also delete the “main.py” file that was generated automatically
by uv. Your project folder should now look like this:</p>
<pre><code>textanalysis-tool/
├── src/
│   └── textanalysis_tool/
├── .gitignore
├── .python-version
├── pyproject.toml
└── README.md</code></pre>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Note that the interior folder has an underscore instead of a hyphen.
We will import the module using the name of the interior folder,
<code>textanalysis_tool</code>. This is important as hyphens are not a
valid character in Python module names.</p>
</div>
</div>
</div>
<p>Next, we’ll create a file called <code>__init__.py</code> in the
<code>src/textanalysis_tool</code> directory. This file will make Python
treat the directory as a package. Next to the <code>__init__.py</code>
file, we can create other Python files that will contain the code for
our module.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>The <code>__init__.py</code> file is a special filename in python
that indicated that the directory should be treated as a package. Often
these files are simply blank, however we can also include some
additional code to initialize the package or set up any necessary
imports, as we will see later.</p>
</div>
</div>
</div>
<p>Let’s create a code file now, called <code>say_hello.py</code> and
put a simple function in it:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">def</span> hello(name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"User"</span>):</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">!"</span></span></code></pre>
</div>
<p>Our project folder should now look like this:</p>
<pre><code>textanalysis-tool/
├── src/
│   └── textanalysis_tool/
│       ├── __init__.py
│       └── say_hello.py
├── .gitignore
├── .python-version
├── pyproject.toml
└── README.md</code></pre>
</section><section><h2 class="section-heading" id="previewing-our-module">Previewing Our Module<a class="anchor" aria-label="anchor" href="#previewing-our-module"></a>
</h2>
<hr class="half-width">
<p>It’s all well and good to write some code in here, but how can we
actually use it? Let’s create a python script to test our module.</p>
<p>Let’s create a directory called “tests”, and start a new file called
<code>test_say_hello.py</code> in it.</p>
<p>Add the following code to it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> textanalysis_tool</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>result <span class="op">=</span> textanalysis_tool.say_hello.hello(<span class="st">"My Name"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="cf">if</span> result <span class="op">==</span> <span class="st">"Hello, My Name!"</span>:</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test passed!"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>One of the really nice things about using <code>uv</code> is that we
can replace <code>python</code> in our commands with <code>uv run</code>
and it will use the environment we have created for the project to run
the code. At the moment, this doesn’t make a difference, but once we
start adding dependencies to our project we’ll see how useful this
is.</p>
</div>
</div>
</div>
<p>Let’s run the script from our command line. If you’re in the root
directory of the project, your command will look something like
<code>uv run tests/test_say_hello.py</code>.</p>
<p>Aaaand… It doesn’t work!</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>D:\Documents\Projects\textanalysis<span class="op">-</span>tool<span class="op">&gt;</span>uv run tests<span class="op">/</span>test_say_hello.py</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  File <span class="st">"D:\Documents\Projects</span><span class="ch">\t</span><span class="st">extanalysis-tool</span><span class="ch">\t</span><span class="st">ests</span><span class="ch">\t</span><span class="st">est_say_hello.py"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="im">from</span> textanalysis_tool.say_hello <span class="im">import</span> hello</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="pp">ModuleNotFoundError</span>: No module named <span class="st">'textanalysis_tool'</span></span></code></pre>
</div>
<p>The reason for this is that we never actually told python where it
can find our code!</p>
</section><section><h2 class="section-heading" id="the-python-path">The Python PATH<a class="anchor" aria-label="anchor" href="#the-python-path"></a>
</h2>
<hr class="half-width">
<p>When you run a command like <code>import pandas</code>, what python
actually does is search the a series of directories in order looking for
a module file called <code>pandas.py</code>. We can see what directories
will be checked by printing the <code>sys.path</code> variable.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="bu">print</span>(sys.path)</span></code></pre>
</div>
<p>We are only interested in checking our current code, not in
installing it as a package. However because we have the
<code>__init__.py</code> file in our package directory, if we add the
exact or relative path to our package directory to our
<code>sys.path</code> variable, python will look there for modules as
well.</p>
<p>Let’s add a quick line to the top of our testing script to add our
specific module directory to the path:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"./src"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello <span class="im">import</span> hello</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>result <span class="op">=</span> hello(<span class="st">"My Name"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="cf">if</span> result <span class="op">==</span> <span class="st">"Hello, My Name!"</span>:</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test passed!"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>This time it works! And if we modify the <code>hello</code> function
to print out something slightly different, we can see that running the
script changes the output right away!</p>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>We used <code>sys.path.insert</code> instead of
<code>sys.path.append</code> because we want to give our module
directory the highest priority when searching for modules. This way, if
there are any naming conflicts with other installed packages, our local
module will be found first.</p>
<p>Ideally you would never be working with a package name that has a
conflict elsewhere in the path directories, but just in case, this
avoids some potential issues.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="dot-notation-in-imports">Dot Notation in Imports<a class="anchor" aria-label="anchor" href="#dot-notation-in-imports"></a>
</h2>
<hr class="half-width">
<p>You probably noticed that our function call mimics the file and
directory structure of the project. We have the project directory
(<code>textanalysis_tool</code>), then the filename
(<code>my_module</code>), and finally the function name
(<code>hello</code>). Python treats all of these similarly when trying
to locate a function or module. We can also modify our import to make
the code a little neater:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"./src"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool <span class="im">import</span> say_hello</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>result <span class="op">=</span> say_hello.hello(<span class="st">"My Name"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="cf">if</span> result <span class="op">==</span> <span class="st">"Hello, My Name!"</span>:</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test passed!"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>or even better:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"./src"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.my_module <span class="im">import</span> hello</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>result <span class="op">=</span> hello(<span class="st">"My Name"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="cf">if</span> result <span class="op">==</span> <span class="st">"Hello, My Name!"</span>:</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test passed!"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="the-init-py-file">The <strong>init</strong>.py File<a class="anchor" aria-label="anchor" href="#the-init-py-file"></a>
</h2>
<hr class="half-width">
<p>We can see that in order to import our function, we have to include
both the name of the module and the name of the file before specifying
the name of the function. Sometimes this can get tedious, especially if
there is a directory in our project with lots of files and different
functions in each file. This is where we can simplify things a little by
adding a tiny bit of code to our <code>__init__.py</code> file:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">from</span> .my_module <span class="im">import</span> hello</span></code></pre>
</div>
<p>We can run our testing script just the same way as before and it will
still work, but we can also now leave out the <code>.my_module</code>
part:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool <span class="im">import</span> hello</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>result <span class="op">=</span> hello(<span class="st">"My Name"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="cf">if</span> result <span class="op">==</span> <span class="st">"Hello, My Name!"</span>:</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test passed!"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="git-add-commit">Git Add / Commit<a class="anchor" aria-label="anchor" href="#git-add-commit"></a>
</h2>
<hr class="half-width">
<p>Before we forget, now that we have some simple code up and running,
let’s add it to our git repository.</p>
<div id="challenge-1-add-a-sub-module" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-add-a-sub-module" class="callout-inner">
<h3 class="callout-title">Challenge 1: Add a Sub Module</h3>
<div class="callout-content">
<p>Create a directory under <code>src/textanalysis_tool</code> called
<code>greetings</code> and add a file called <code>greet.py</code> with
a function called greet that prints out the following:</p>
<pre><code>Hello {User}!
It's nice to meet you!</code></pre>
<p>How do you call this function from your testing script?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello.greetings <span class="im">import</span> greet</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>greet(<span class="st">"My Name"</span>)</span></code></pre>
</div>
<p>You could also include this line in our existing
<code>__init__.py</code> file:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello.greetings <span class="im">import</span> greet</span></code></pre>
</div>
<p>or add another <code>__init__.py</code> and include the following
line:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello.greetings <span class="im">import</span> greet</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2-inter-module-imports" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-inter-module-imports" class="callout-inner">
<h3 class="callout-title">Challenge 2: Inter-Module imports</h3>
<div class="callout-content">
<p>Building on the last challenge, the first line of our greeting is
identical to the output from our <code>hello</code> function. How can we
avoid code duplication by calling the <code>hello</code> function from
within our <code>greet</code> function?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>In our greetings.py file:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool <span class="im">import</span> hello</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="kw">def</span> greet(name):</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    <span class="cf">return</span> hello(name) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">It's nice to meet you!"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Why are you bothering to write out the entire module path in
greetings.py? Can’t you just do this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">from</span> ..my_module <span class="im">import</span> hello</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="kw">def</span> greet(name):</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    hello(name)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"It's nice to meet you!"</span>)</span></code></pre>
</div>
<p>Yes, you absolutely can! The dot-notation used in python pathing can
use <code>..</code> to refer to the parent directory, or even
<code>...</code> to refer to a grandparent directory.</p>
<p>The reason we’re not doing this here is for clarity, as reccomended
in <a href="https://www.python.org/dev/peps/pep-0008/#imports" class="external-link">PEP8</a>.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-class-objects"><p>Content from <a href="03-class-objects.html">Class Objects</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/03-class-objects.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a class object?</li>
<li>How can I defined a class object in Python?</li>
<li>How can I use a class object in my module?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a Class object in our module.</li>
<li>Demonstrate how to use our Class object in a sample script.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-a-class-object">What is a Class Object?<a class="anchor" aria-label="anchor" href="#what-is-a-class-object"></a>
</h2>
<hr class="half-width">
<p>You can think of a class object as a kind of “blueprint” for an
object. It defines what properties the object can have, and what methods
it can perform. Once a class is defined, you can create any number of
objects based on that class, each of which is referred to as an
“instance” of that class.</p>
<p>As an example, let’s imagine a Car. A Car has many properties and can
do many things, but for our purposes, let’s limit them slightly. Our Car
will have a make, model, year, and color, and it will be able to honk,
and be painted.</p>
<p>The make, model, year, and color are all “properties” of the car.
Honking a horn and being painted are both “methods” of the car. Here’s a
diagram of our car object:</p>
<figure><img src="./fig/03-class-objects/car_class.PNG" alt="Car Class object example" class="figure mx-auto d-block"><div class="figcaption">Car Class object example</div>
</figure><p>In python we can define a class object like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">class</span> Car:</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>):</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>        <span class="va">self</span>.make <span class="op">=</span> make</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> model</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>        <span class="va">self</span>.year <span class="op">=</span> year</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> color</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="kw">def</span> honk(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"beep"</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="kw">def</span> paint(<span class="va">self</span>, new_color: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> new_color</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>The convention in python is that all classes should be named in
CamelCase, with no underscores. Class names in reality can be anything
you like, but this is the standard in the python community.</p>
</div>
</div>
</div>
<p>Some of this might look familiar if you think about how we define
functions in Python. There’s a <code>def</code> keyword, followed by the
function name and parentheses. Inside the parentheses, we can define
parameters, and these parameters can contain default values. We can also
include type hints, for both parameters and return values. However all
of this is indented one level, underneath the <code>class</code>
keyword, which is followed by our class name.</p>
<p>Note that this is just our blueprint - it doesn’t refer to any
specific car, just the general idea of a car. Also note the
<code>__init__</code> method. This is a special method which is called
whenever you “instantiate” a new object. The parameters for this
function are supplied when we first create an object and function
similarly to a method, in that if no default value is provided, it is
required in order to create the object, and if a default value is
provided, it is optional.</p>
<p>An instance of a car, in this case called “my_car” might look
something like this:</p>
<figure><img src="./fig/03-class-objects/car_instance.PNG" alt="Car Instance example" class="figure mx-auto d-block"><div class="figcaption">Car Instance Example</div>
</figure><p>Also note that each of the methods within the class object definition
starts with a “self” argument. This is a reference to the current
instance of the class, and is used to access variables that belong to
the class. In our example, we store the make, model, year and color as
properties of the class. When we call the <code>paint</code> method, we
use <code>self.color</code> to refer to the current instance’s color
property.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>The <code>__init__</code> method is called a “dunder” (double
underlined) method in python. There are a number of other dunder methods
that we can define, that will interact with various built-in functions
and operators. For example, we can define a <code>__str__</code> method,
that will allow us to specify how our object should be represented as a
string when we call <code>str()</code> on it. Likewise, we can define
<code>__eq__</code>, which would tell python how to behave when we
compare two objects for equality.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="a-class-object-for-our-project">A Class object for Our project<a class="anchor" aria-label="anchor" href="#a-class-object-for-our-project"></a>
</h2>
<hr class="half-width">
<p>Let’s create a class object for our text analysis project. We’re
going to be downloading some books from <a href="https://www.gutenberg.org/" class="external-link">Project Gutenberg</a>. To make things
easy to begin with, we’ll limit ourselves to just the .txt files.</p>
<p>Since we’re going to create some useful objects and methods for
working with documents, let’s define a <code>Document</code> class.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div class="callout-inner">
<div class="callout-content">
<p>Take a look a an example txt document from Project Gutenberg: <a href="https://www.gutenberg.org/cache/epub/2680/pg2680.txt" class="external-link">Meditations,
by Marcus Aurelius</a></p>
<p>What properties and methods might we want to include in our Document
class?</p>
</div>
</div>
</div>
<p>It looks like there’s a standard metadata section in these documents,
with a Title, Author, Release Date, Language, and Credits. Those will
probably be useful metadata. Looking at the url for this file, it also
looks like there’s an ID on Project Gutenberg.</p>
<p>For methods, we’ll need to be able to read the document from a file.
And for some simple methods, let’s count the number of lines in a
document, and another method to get the number of times a particular
word appears.</p>
<p>Lets start writing our class object in a new file:
<code>src/textanalysis_tool/document.py</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>, title: <span class="bu">str</span>, author: <span class="bu">str</span> <span class="op">=</span> <span class="st">""</span>, <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> title</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> author</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> <span class="va">self</span>.read(<span class="va">self</span>.filepath)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">file</span>.read()</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="kw">def</span> get_line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span></code></pre>
</div>
<p>Our class object <code>Document</code> is a “blueprint” for a
collection of methods. When we define it, we have to provide the class
with a filepath, a title, an author, and an id. Only the filepath and
the title are required, while the author and id are optional.</p>
<p>The <code>__init__</code> method is called as soon as the object is
created, and we can see that in addition to storing the parameters to
their <code>self</code> counterparts, there is an additional property
called <code>self._content</code>. This property is used to store the
entire text content of the document. We obtain this by calling the
<code>self._read</code> method, which reads the content from the
specified file.</p>
<div id="principle-of-least-astonishment-or-were-all-adults-here" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="principle-of-least-astonishment-or-were-all-adults-here" class="callout-inner">
<h3 class="callout-title">Principle of Least Astonishment (or, We’re All
Adults Here)</h3>
<div class="callout-content">
<p>Unlike other programming languages, python doesn’t have the concept
of “private” or “internal” variables and methods. Instead there is a
convention which says that any variable or method that is intended for
internal use should be prefixed with an underscore
(e.g. <code>_content</code>). This is however just a convention - there
is nothing stopping you from accessing these variables and methods from
outside the class if you really want to.</p>
</div>
</div>
</div>
<p>There are also two methods that we’ve defined -
<code>get_line_count</code> and <code>get_word_occurrence</code>.
Neither of these will be called directly on the class itself, but rather
on instances of the class that we create (as indicated by the use of
<code>self</code> within the class methods). Note that these methods
make use of the <code>self._content</code> property - this is a variable
that is not defined within the method, so you may expect it to be out of
scope. However the <code>self</code> keyword refers to the specific
instance of the class itself, and so it has access to all of its
properties and methods, including the <code>self._content</code>
property.</p>
</section><section><h2 class="section-heading" id="trying-out-our-class-object">Trying out Our Class Object<a class="anchor" aria-label="anchor" href="#trying-out-our-class-object"></a>
</h2>
<hr class="half-width">
<p>Let’s try out our new class object. Create a file in our “tests”
directory called <code>example_file.txt</code> and add some text to
it:</p>
<pre><code>This is a test document. It contains words.
It is only a test document.</code></pre>
<p>Next, let’s create another test file. Our last one was called
<code>test_my_modue.py</code>, so let’s call this
<code>test_document.py</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"./src"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>total_tests <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>passed_tests <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>failed_tests <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># Check that we can create a Document object</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>, title<span class="op">=</span><span class="st">"Test Document"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="cf">if</span> doc.title <span class="op">==</span> <span class="st">"Test Document"</span> <span class="kw">and</span> doc.filepath <span class="op">==</span> <span class="st">"tests/example_file.txt"</span>:</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    passed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    failed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co"># Test the methods</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="cf">if</span> doc.get_line_count() <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    passed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    failed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="cf">if</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    passed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    failed_tests <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total tests: </span><span class="sc">{</span>total_tests<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Passed tests: </span><span class="sc">{</span>passed_tests<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Failed tests: </span><span class="sc">{</span>failed_tests<span class="sc">}</span><span class="ss">"</span>)</span></code></pre>
</div>
<p>Now we’ll run this file using our uv environment:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">uv</span> run tests/test_document.py</span></code></pre>
</div>
<p>You should see the output:</p>
<pre><code>Total tests: 3
Passed tests: 3
Failed tests: 0</code></pre>
<div id="challenge-1-testing-out-our-class-on-real-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-testing-out-our-class-on-real-data" class="callout-inner">
<h3 class="callout-title">Challenge 1: Testing Out Our Class on Real
Data</h3>
<div class="callout-content">
<p>Let’s download a real text file from Project Gutenberg and see how
our class object handles it. You can pick any file you like, or you can
use the same one we looked at earlier: <a href="https://www.gutenberg.org/cache/epub/2680/pg2680.txt" class="external-link">Meditations,
by Marcus Aurelius</a>.</p>
<p>Modify your <code>test_document.py</code> file to create a new
Document object using the real text file, and then test out the
<code>get_line_count</code> and <code>get_word_occurrence</code> methods
on it. What do you get? What issues might there be when we start using
this class on our actual data?</p>
<p>How can we improve our class to handle these issues?</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>The Metadata at the start of the document is always gated by a line
that says
<code>*** START OF THE PROJECT GUTENBERG EBOOK {the title of the book} ***</code>
and at the end of the document with the line
<code>*** END OF THE PROJECT GUTENBERG EBOOK {the title of the book} ***</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" data-bs-parent="#accordionHint2" aria-labelledby="headingHint2">
<div class="accordion-body">
<p>There is a python module called <code>re</code> that allows us to
work with regular expressions. This can be used to match specific
patterns in text, or for extracting specific parts of a string. You can
use the following regex pattern to match the content between the start
and end markers:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>pattern <span class="op">=</span> <span class="vs">r"\*\*\* START OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The Project Gutenberg text files have a lot of metadata at the start
and end of the file, which will affect the line count and word
occurrence counts. We might want to modify our <code>self.read</code>
method to strip out this metadata before storing the content in
<code>self.content</code>.</p>
<p>One possible solution would look like this:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"\*\*\* START OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>, title: <span class="bu">str</span>, author: <span class="bu">str</span> <span class="op">=</span> <span class="st">""</span>, <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> <span class="va">self</span>.get_content(filepath)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> title</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> author</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>        match <span class="op">=</span> re.search(<span class="va">self</span>.CONTENT_PATTERN, raw_text, re.DOTALL)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss"> is not a valid Project Gutenberg Text file."</span>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">file</span>.read()</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="kw">def</span> get_line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2-extracting-the-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-extracting-the-metadata" class="callout-inner">
<h3 class="callout-title">Challenge 2: Extracting the Metadata</h3>
<div class="callout-content">
<p>From the previous challenge, we saw that the Project Gutenberg text
files have a lot of metadata at the start and end of the file. This
metadata includes the title, author, release date, and other information
about the book which we currently are adding to our file using
parameters.</p>
<p>Instead of passing this information in as parameters, can you modify
the class so that it extracts the title, author and id from the metadata
in the text file itself?</p>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Give me a hint </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" data-bs-parent="#accordionHint3" aria-labelledby="headingHint3">
<div class="accordion-body">
<p>As before, we can use the <code>re</code> module to extract this
information. The title and author are contained in lines that start with
<code>Title:</code> and <code>Author:</code> respectively. The ID can be
found in the line that starts with <code>Release Date:</code>. You can
use the following regex patterns to match these lines:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>TITLE_PATTERN <span class="op">=</span> <span class="vs">r"^Title:\s*(.*?)\s*$"</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>AUTHOR_PATTERN <span class="op">=</span> <span class="vs">r"^Author:\s*(.*?)\s*$"</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>ID_PATTERN <span class="op">=</span> <span class="vs">r"^Release date:\s*.*?\[eBook #(\d+)\]"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>There’s any number of ways to do this, but one possible solution
would look like this:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    TITLE_PATTERN <span class="op">=</span> <span class="vs">r"^Title:\s*(.*?)\s*$"</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    AUTHOR_PATTERN <span class="op">=</span> <span class="vs">r"^Author:\s*(.*?)\s*$"</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    ID_PATTERN <span class="op">=</span> <span class="vs">r"^Release date:\s*.*?\[eBook #(\d+)\]"</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"\*\*\* START OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>):</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> <span class="va">self</span>.get_content(filepath)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> raw_text:</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> contains no content."</span>)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>        metadata <span class="op">=</span> <span class="va">self</span>.get_metadata(filepath)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> metadata.get(<span class="st">"title"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> metadata.get(<span class="st">"author"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> metadata.get(<span class="st">"id"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    <span class="kw">def</span> _extract_metadata_element(<span class="va">self</span>, pattern: <span class="bu">str</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>        match <span class="op">=</span> re.search(pattern, text, re.MULTILINE)</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>        match <span class="op">=</span> re.search(<span class="va">self</span>.CONTENT_PATTERN, raw_text, re.DOTALL)</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss"> is not a valid Project Gutenberg Text file."</span>)</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>        title <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.TITLE_PATTERN, raw_text)</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>        author <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.AUTHOR_PATTERN, raw_text)</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>        extracted_id <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.ID_PATTERN, raw_text)</span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>            <span class="st">"title"</span>: title,</span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>            <span class="st">"author"</span>: author,</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>            <span class="st">"id"</span>: <span class="bu">int</span>(extracted_id) <span class="cf">if</span> extracted_id <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>        }</span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">file</span>.read()</span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a>    <span class="kw">def</span> get_line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._content.splitlines())</span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._content.lower().count(word.lower())</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-3-properties" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-3-properties" class="callout-inner">
<h3 class="callout-title">Challenge 3: Properties</h3>
<div class="callout-content">
<p>In our current implementation, the <code>title</code>,
<code>author</code>, and <code>id</code> attributes are publicly
accessible from outside the class, which means that they can be modified
directly. There are instances where it might be preferable for the
attributes to be read-only, so that they can only be set when the object
is created, and not modified afterwards, or to allow us to create
variables that are based or calculated from other variables and should
not be set directly.</p>
<p>We can do this with the <code>@property</code> decorator. This is a
special decorator that allows us to define “getter” and “setter” methods
for a property. It works much the same as a normal method, but it is
accessed like an attribute.</p>
<p>We can convert our <code>get_line_count</code> method to a property
like this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>    ...</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="kw">def</span> line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    ...</span></code></pre>
</div>
<p>The links to the project gutenberg files are based on the id, which
we extracted from the metadata. Create a new property called
<code>gutenberg_url</code> that returns the url for the document based
on the id.</p>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Give me a hint </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" data-bs-parent="#accordionHint4" aria-labelledby="headingHint4">
<div class="accordion-body">
<p>The url for a Project Gutenberg text file is of the form:
<code>https://www.gutenberg.org/cache/epub/&lt;id&gt;/pg&lt;id&gt;.txt</code></p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>There’s any number of ways to do this, but one possible solution
would look like this:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="kw">def</span> gutenberg_url(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">id</span>:</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"https://www.gutenberg.org/cache/epub/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">/pg</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Neat! We’ve successfully created and used a class object in our
module. But certainly there’s a better way to test this, right? In the
next episode, we’ll look at how to write proper unit tests for our class
object with <code>pytest</code>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>foo</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-04-unit-testing"><p>Content from <a href="04-unit-testing.html">Unit Testing</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/04-unit-testing.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is unit testing?</li>
<li>Why is unit testing important?</li>
<li>How do you write a unit test in Python?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain the concept of unit testing</li>
<li>Demonstrate how to write and run unit tests in Python using
<code>pytest</code>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="unit-testing">Unit Testing<a class="anchor" aria-label="anchor" href="#unit-testing"></a>
</h2>
<hr class="half-width">
<p>We have our two little test files, but you might imagine that it’s
not particuarly efficient to always write individual scripts to test our
code. What if we had a lot of functions or classes? Or a lot of
different ideas to test? What if our objects changed down the line? Our
existing modules are going to be diffucult to maintain, and, as you may
have expected, there is alredy a solution for this problem.</p>
<div class="section level3">
<h3 id="what-makes-for-a-good-test">What Makes For a Good Test?<a class="anchor" aria-label="anchor" href="#what-makes-for-a-good-test"></a>
</h3>
<p>A good test is one that is: - <strong>Isolated</strong>: A good test
should be able to run independently of other tests, and should not rely
on external resources such as databases or web services. -
<strong>Repeatable</strong>: A good test should produce the same results
every time it is run. - <strong>Fast</strong>: A good test should run
quickly, so that it can be run frequently during development. -
<strong>Clear</strong>: A good test should be easy to understand, so
that other developers can easily see what is being tested and why. Not
just in the output provided by the test, but the variables, function
names, and structure of the test should be clear and descriptive.</p>
<p>It can be easy to get carried away with testing everything and
writing tests that cover every single case that you can come up with.
However having a massive test suite that is cumbersome to update and
takes a long time to run is not useful. A good rule of thumb is to focus
on testing the most important parts of your code, and the parts that are
most likely to break. This often means focusing on edge cases and error
handling, rather than trying to test every possible input.</p>
<p>Generally, a good test module will test the basic functionality of an
object or function, as well as a few edge cases.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div class="callout-inner">
<div class="callout-content">
<p>What are some edge cases that you can think of for the
<code>hello</code> function we wrote earlier?</p>
<p>What about the <code>Document</code> class?</p>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Some edge cases for the <code>hello</code> function could
include:</p>
<ul>
<li>Passing in an empty string</li>
<li>Passing in a very long string</li>
<li>Passing in something that is not a string (e.g. a number or a
list)</li>
</ul>
<p>Some edge cases for the <code>Document</code> class could
include:</p>
<ul>
<li>Passing in a file path that does not exist</li>
<li>Passing in a file that is not a text file</li>
<li>Passing in a file that is empty</li>
<li>Passing in a word that does not exist in the document when testing
<code>get_word_occurrence</code>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pytest">pytest<a class="anchor" aria-label="anchor" href="#pytest"></a>
</h2>
<hr class="half-width">
<p><code>pytest</code> is a testing framework for Python that helps to
write simple and scalable test cases. It is widely used in the python
community, and has in-depth and comprehensive documentation. We won’t be
getting into all of the different things you can do with pytest, but we
will cover the basics here.</p>
<p>To start off with, we need to add pytest to our environment. However
unlike our previous packages, <code>pytest</code> is not required for
our module to work, it is only used by us as we are writing code.
Therefore it is a “development dependency”. We can still add this to our
<code>pyproject.toml</code> file via uv, but we need to add a special
flag to our command so that it goes in the correct place.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">uv</span> add pytest <span class="at">--dev</span></span></code></pre>
</div>
<p>If you open up your <code>pyproject.toml</code> file, you should see
that <code>pytest</code> has been added under a new called “dependency
groups” (your version number may be different):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">[dependency-groups]</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="dt">dev</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="st">"pytest&gt;=8.4.2"</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<p>Now we can start creating our tests.</p>
<div class="section level3">
<h3 id="writing-a-pytest-test-file">Writing a pytest Test File<a class="anchor" aria-label="anchor" href="#writing-a-pytest-test-file"></a>
</h3>
<p>Part of <code>pytest</code> is the concept of “test discovery”. This
means that pytest will automatically find any test files that follow a
certain naming convention. By default, pytest will look for files that
start with <code>test_</code> or end with <code>_test.py</code>. Inside
these files, pytest will look for functions that start with
<code>test_</code>.</p>
<p>Now, our files already have the correct names, so we just need to
change the contents. Let’s start with <code>test_say_hello.py</code>.
Open it up and replace the contents with the following:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello <span class="im">import</span> hello</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> test_hello():</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="cf">assert</span> hello(<span class="st">"My Name"</span>) <span class="op">==</span> <span class="st">"Hello, My Name!"</span></span></code></pre>
</div>
<p>In our previous test file, we had to add the path to our module each
time. Now that we are using <code>pytest</code>, we can use a special
file called <code>conftest.py</code> to add this path automatically.
Create a file called <code>conftest.py</code> in the <code>tests</code>
directory and add the following code to it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"./src"</span>)</span></code></pre>
</div>

<p>Now, we just need to run the tests. We can do this with the following
command:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">uv</span> run pytest</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Note that we are using <code>uv run</code> to run pytest, this
ensures that pytest is run in the correct environment with all the
dependencies we have installed.</p>
</div>
</div>
</div>
<p>You should see output similar to the following:</p>
<pre><code>============================= test session starts ==============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\Documents\Projects\textanalysis-tool
configfile: pyproject.toml
collected 1 item

tests\test_say_hello.py .                                          [100%]
============================== 1 passed in 0.12s ===============================</code></pre>
<p>Why didn’t it run the other test file? Because even though the file
is named correctly, it doesn’t contain any functions that start with
<code>test_</code>. Let’s fix that now.</p>
<p>Open up <code>test_document.py</code> and replace the contents with
the following:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">def</span> test_create_document():</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    Document.CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"(.*)"</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">assert</span> doc.filepath <span class="op">==</span> <span class="st">"tests/example_file.txt"</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="kw">def</span> test_document_word_count():</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    Document.CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"(.*)"</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_line_count() <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="kw">def</span> test_document_word_occurrence():</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    Document.CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"(.*)"</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Our example file doesn’t exactly look like a Project Gutenberg text
file, so we need to change the <code>CONTENT_PATTERN</code> to match
everything. This is a class level variable, so we can change it on the
class itself, rather than on the instance.</p>
</div>
</div>
</div>
<p>Let’s run our tests again:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">uv</span> run pytest</span></code></pre>
</div>
<p>You should see output similar to the following:</p>
<pre><code>============================= test session starts ==============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\Documents\Projects\textanalysis-tool
configfile: pyproject.toml
collected 4 items

tests\test_document.py ...                                      [ 75%]
tests\test_say_hello.py .                                       [100%]
============================== 4 passed in 0.15s ===============================</code></pre>
<p>You can see that all of the tests have passed. There is a small green
pip for each test that was performed, and a summary at the end. Compare
this to the test file we had before. We got rid of all of the if
statements, and just use the <code>assert</code> statement to check if
the output is what we expect.</p>
</div>
<div class="section level3">
<h3 id="testing-edge-cases-exceptions">Testing Edge Cases / Exceptions<a class="anchor" aria-label="anchor" href="#testing-edge-cases-exceptions"></a>
</h3>
<p>Let’s add an edge case to our tests. Open up
<code>test_say_hello.py</code> and add a test case for an empty
string:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello <span class="im">import</span> hello</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">def</span> test_hello():</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="cf">assert</span> hello(<span class="st">"My Name"</span>) <span class="op">==</span> <span class="st">"Hello, My Name!"</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="kw">def</span> test_hello_empty_string():</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="cf">assert</span> hello(<span class="st">""</span>) <span class="op">==</span> <span class="st">"Hello, !"</span></span></code></pre>
</div>
<p>Run the tests again:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">uv</span> run pytest</span></code></pre>
</div>
<p>We get passing tests, which is what we expect. But we are the ones in
charge of the function, what if we say that if the user doesn’t provide
a name, we want to raise an exception? Let’s change the test to say that
if the user provides an empty string, we want to raise a
<code>ValueError</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.say_hello <span class="im">import</span> hello</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="kw">def</span> test_hello():</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="cf">assert</span> hello(<span class="st">"My Name"</span>) <span class="op">==</span> <span class="st">"Hello, My Name!"</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="kw">def</span> test_hello_empty_string():</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>        hello(<span class="st">""</span>)</span></code></pre>
</div>
<p>Run the tests again:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">uv</span> run pytest</span></code></pre>
</div>
<p>This time, we get a failing test, because the <code>hello</code>
function DID NOT raise a <code>ValueError</code>. Let’s change the
<code>hello</code> function to raise a <code>ValueError</code> if the
name is an empty string:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="kw">def</span> hello(name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"User"</span>):</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="cf">if</span> name <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Name cannot be empty"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">!"</span></span></code></pre>
</div>
<p>Running the tests again, we can see that all the tests pass.</p>
</div>
<div class="section level3">
<h3 id="fixtures">Fixtures<a class="anchor" aria-label="anchor" href="#fixtures"></a>
</h3>
<p>One of the great features of pytest is the ability to use fixtures.
Fixtures are a way to provide data, state or configurations to your
tests. For example, we have a line in each of our tests that creates a
new <code>Document</code> object. We can use a fixture to create this
object once, and then use it in each of our tests. That way, if we need
to change the way we create the object in the future, we only need to
change it in one place.</p>
<p>Let’s create a fixture for our <code>Document</code> object. Open up
<code>test_document.py</code> and add the following import at the
top:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">import</span> pytest</span></code></pre>
</div>
<p>Then, add the following code below the imports:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="kw">def</span> doc():</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="cf">return</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span></code></pre>
</div>
<p>Now, we can use this fixture in our tests. Update the test functions
to accept a parameter called <code>doc</code>, and remove the line that
creates the <code>Document</code> object. The updated test file should
look like this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="kw">def</span> doc():</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    Document.CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"(.*)"</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>    <span class="cf">return</span> Document(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="kw">def</span> test_create_document(doc):</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>    <span class="cf">assert</span> doc.title <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>    <span class="cf">assert</span> doc.filepath <span class="op">==</span> <span class="st">"tests/example_file.txt"</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="kw">def</span> test_document_word_count(doc):</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_line_count() <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="kw">def</span> test_document_word_occurrence(doc):</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Because our Documents are validated by searching for a starting and
ending regex pattern, our test files will not have that. We could ensure
that our test files would, or we can just temporarily alter the search
pattern for the duration of the test. <code>CONTENT_PATTERN</code> is a
class level variable, so we need to modify it before the instance is
created.</p>
</div>
</div>
</div>
<p>Let’s run our tests again. Nothing changed in the output, but our
code is now cleaner and easier to maintain.</p>
</div>
<div class="section level3">
<h3 id="monkey-patching">Monkey Patching<a class="anchor" aria-label="anchor" href="#monkey-patching"></a>
</h3>
<p>Another useful feature of pytest is monkey patching. Monkey patching
is a way to modify or extend the behavior of a function or class during
testing. This is useful when you want to test a function that depends on
an external resource, such as a database, file system or web resource.
Instead of actually accessing the external resource, you can use monkey
patching to replace the function that accesses the resource with a mock
function that returns a predefined value.</p>
<p>In our use case, we have a file called <code>example_file.txt</code>
that we use to test our <code>Document</code> class. However, if we
wanted to test the <code>Document</code> class with files that have
different contents, would need to create a whole array of different test
files. Instead, we can use monkey patching to replace the
<code>open</code> function, so that instead of actually opening a file,
it returns a string that we define.</p>
<p>Let’s monkey patch the <code>open</code> function in our
<code>test_document.py</code> file. First, we need to import the
<code>monkeypatch</code> fixture from <code>unittest.mock</code> (a
python built-in module). Add the following import at the top of the
file:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> mock_open</span></code></pre>
</div>
<p>Then, we can create a new fixture that monkey patches the
<code>open</code> function. Add the following code below the
<code>doc</code> fixture:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="at">@pytest.fixture</span>(autouse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="kw">def</span> mock_file(monkeypatch):</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">"This is a test document. It contains words.</span><span class="ch">\n</span><span class="st">It is only a test document."</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="cf">return</span> mock</span></code></pre>
</div>
<p>The other difference you’ll notice is that we added the parameter
<code>autouse=True</code> to the fixture. This means that, within this
test file, this specific fixture will be automatically applied to all
tests, without needing to explicitly include it as a parameter in each
test function.</p>
<p>Go ahead and delete the <code>example_file.txt</code> file, and run
the tests again. Your tests should still pass, even though the file
doesn’t exist anymore. This is because we are using monkey patching to
replace the <code>open</code> function with a mock function that returns
the string we defined.</p>
</div>
<div class="section level3">
<h3 id="edge-cases-again-test-driven-development">Edge Cases Again / Test Driven Development<a class="anchor" aria-label="anchor" href="#edge-cases-again-test-driven-development"></a>
</h3>
<p>Let’s go back and think about other things that might go wrong with
our <code>Document</code> class. What if the user provides a file path
that doesn’t exist? What if the user provides a file that is not a text
file? Or a file that is empty of content? Rather than write these into
our class object, we can first write tests that will check for the
behavior we expect or want in these edge cases, see if they fail, and
then update our class object to make the tests pass. This is called
“Test Driven Development” (TDD), and is a common practice in software
development.</p>
<p>Let’s add a test for a file that is empty. In this case, we would
want the initialization of the object to fail with a
<code>ValueError</code>. However for this test, we can’t use our
fixtures from above, so we’ll have to code it into the test. Add the
following to <code>test_document.py</code>:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="kw">def</span> test_empty_file(monkeypatch):</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    <span class="co"># Mock an empty file</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>        Document(filepath<span class="op">=</span><span class="st">"empty_file.txt"</span>)</span></code></pre>
</div>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Because we are monkeypatching the <code>open</code> function, we
don’t actually need to have a file called <code>empty_file.txt</code> in
our tests directory. The <code>open</code> function will be replaced
with our mock function that returns an empty string. We are providing a
file name here to be consistent with the <code>Document</code> class
initialization, and we are using the name to act as additional
information for later developers to clarify the intent of the test.</p>
</div>
</div>
</div>
<p>Run the tests again:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">uv</span> run pytest</span></code></pre>
</div>
<p>It fails, as we expect. Now, let’s update the <code>Document</code>
class to raise a <code>ValueError</code> if the file is empty. Open up
<code>document.py</code> and update the <code>__init__</code> method to
the following:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>, title: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Untitled Document"</span>):</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>    <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>    <span class="va">self</span>.title <span class="op">=</span> title</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>        <span class="va">self</span>._content <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._content:</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> contains no content."</span>)</span></code></pre>
</div>
<div id="challenge-1-additional-edge-case" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-additional-edge-case" class="callout-inner">
<h3 class="callout-title">Challenge 1: Additional Edge Case</h3>
<div class="callout-content">
<p>Try adding a test for another edge case, this time for a file that is
not actually a text file, for example, a binary file or an image file.
Then, update the <code>Document</code> class to make the test pass.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>You can mock a binary file by using the <code>mock_open</code>
function from the <code>unittest.mock</code> module, and using the
<code>read_data</code> parameter to provide binary data like
<code>b'\x00\x01\x02'</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>In the <code>Document</code> class, we need to check if the data read
from the file is binary data. The <code>read</code> method of a file
object is clever enough to return binary data as a <code>bytes</code>
object, so we can check if the data in <code>self._content</code> is an
instance of type <code>bytes</code>. If it is, we can raise a
<code>ValueError</code>.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>text_data <span class="op">=</span> <span class="st">"This is a test string."</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(text_data, <span class="bu">bytes</span>):</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"File is not a valid text file."</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>binary_data <span class="op">=</span> <span class="st">b'</span><span class="ch">\x00\x01\x02</span><span class="st">'</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(binary_data, <span class="bu">bytes</span>):</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"File is not a valid text file."</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>You can create a test that simulates opening a binary file by using
the <code>mock_open</code> function from the <code>unittest.mock</code>
module. Here’s an example of how you might write such a test:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="kw">def</span> test_binary_file(monkeypatch):</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    <span class="co"># Mock a binary file</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">b'</span><span class="ch">\x00\x01\x02</span><span class="st">'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>        Document(filepath<span class="op">=</span><span class="st">"binary_file.bin"</span>)</span></code></pre>
</div>
<p>And then, in the <code>Document</code> class, you can check if the
data read from the file is binary data like this:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>, title: <span class="bu">str</span>, author: <span class="bu">str</span> <span class="op">=</span> <span class="st">""</span>, <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> title</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> author</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>        <span class="va">self</span>._content <span class="op">=</span> <span class="va">self</span>._read(<span class="va">self</span>.filepath)</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._content:</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> contains no content."</span>)</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>._content, <span class="bu">bytes</span>):</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> is not a valid text file."</span>)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>...</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>We can use <code>pytest</code> to write and run unit tests in
Python.</li>
<li>A good test is isolated, repeatable, fast, and clear.</li>
<li>We can use fixtures to provide data or state to our tests.</li>
<li>We can use monkey patching to modify the behavior of functions or
classes during testing.</li>
<li>Test Driven Development (TDD) is a practice where we write tests
before writing the code to make the tests pass.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-05-extending-classes"><p>Content from <a href="05-extending-classes.html">Extending Classes with Inheritance</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/05-extending-classes.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What if we want classes that are similar, but handle slightly
different cases?</li>
<li>How can we avoid duplicating code in our classes?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain the concept of inheritance in object-oriented
programming</li>
<li>Demonstrate how to create a subclass that inherits from a parent
class</li>
<li>Show how to override methods and properties in a subclass</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="extending-classes-with-inheritance">Extending Classes with Inheritance<a class="anchor" aria-label="anchor" href="#extending-classes-with-inheritance"></a>
</h2>
<hr class="half-width">
<p>So far you may be wondering why classes are useful. After all, all
we’ve really done in essence is make a tiny module with some functions
in it that are slightly more complicated than normal functions. One of
the real powers of classes is the ability to limit code duplicate
through a concept called inheritance.</p>
<div class="section level3">
<h3 id="inheritance">Inheritance<a class="anchor" aria-label="anchor" href="#inheritance"></a>
</h3>
<p>Inheritance is a way to create a new class that contains all of the
same properties and methods as an existing class, but allows us to add
additional new properties and methods, or to override existing methods.
This allows us to create a new class that is a specialized version of an
existing class, without having to rewrite a whole bunch of code.</p>
<p>Taking a look at our Car class from earlier, we might want to create
a new class for a specific type of car, like a Convertable Car. A
Convertible Car is a type of Car, so it should have everything that a
Car has, but it also has some additional properties and methods, for
example, it might have a property to indicate whether the roof is up or
down. We can create a new class called ConvertibleCar that inherits from
the Car class, and then add the new property and method to it.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">class</span> ConvertibleCar(Car):</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>):</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(make, model, year, color)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>        <span class="va">self</span>.roof_is_up <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="kw">def</span> lower_roof(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>        <span class="va">self</span>.roof_is_up <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="kw">def</span> raise_roof(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        <span class="va">self</span>.roof_is_up <span class="op">=</span> <span class="va">True</span></span></code></pre>
</div>
<p>You can see that the ConvertibleCar class is defined in a similar way
to the Car class, but it inherits from the Car class by including it in
parentheses after the class name. The <code>__init__</code> method of
the ConvertibleCar class also has a call to
<code>super().__init__()</code>. The <code>super()</code> function is a
way to refer specifically to the parent class, in this case, the Car
class. This allows us to call the <code>__init__</code> method of the
Car class, which sets up all of the properties that a Car has.</p>
</div>
<div class="section level3">
<h3 id="applying-inheritance-to-our-document-class">Applying Inheritance to Our Document Class<a class="anchor" aria-label="anchor" href="#applying-inheritance-to-our-document-class"></a>
</h3>
<p>For our <code>Document</code> class, we have a few different types of
documents available from the Project Gutenberg website. We are currently
using plain text files, but there are also HTML files that we can
download. They will have the same information, but the data within will
be structured in a slightly different way. We can use inheritance to
create a pair of new classes: <code>HTMLDocument</code> and
<code>PlainTextDocument</code>, that both inherit from the
<code>Document</code> class. This will allow us to keep all of the
common functionality in the <code>Document</code> class, but to add any
additional functionality specific to each document type.</p>
<p>Most of what we’ve written so far is specific to reading and parsing
data out of the plain text files, so almost all of the code from
<code>Document</code> can be copied. We’ll leave the functions for
<code>gutenberg_url</code>, <code>get_line_count</code>, and
<code>get_word_occurrence</code>.</p>
<p>In addition, we’ll need an <code>__init__</code> in our
<code>Document</code> class. At the moment, all it does is save the
filename in the <code>filename</code> property, but we might expand this
in the future. We’ll also need a reference to the
<code>super().__init__()</code> in our <code>PlainTextDocument</code>.
At the moment, our classes look like this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="kw">def</span> gutenberg_url(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">id</span>:</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"https://www.gutenberg.org/cache/epub/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">/pg</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>):</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="kw">def</span> get_line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._content.splitlines())</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._content.lower().count(word.lower())</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">class</span> PlainTextDocument(Document):</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    TITLE_PATTERN <span class="op">=</span> <span class="vs">r"^Title:\s*(.*?)\s*$"</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    AUTHOR_PATTERN <span class="op">=</span> <span class="vs">r"^Author:\s*(.*?)\s*$"</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    ID_PATTERN <span class="op">=</span> <span class="vs">r"^Release date:\s*.*?\[eBook #(\d+)\]"</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"\*\*\* START OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>):</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(filepath<span class="op">=</span>filepath)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>._read(<span class="va">self</span>.filepath)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> raw_text:</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> contains no content."</span>)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(raw_text, <span class="bu">bytes</span>):</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> is not a valid text file."</span>)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> <span class="va">self</span>._get_metadata(raw_text, <span class="va">self</span>.TITLE_PATTERN)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> <span class="va">self</span>._get_metadata(raw_text, <span class="va">self</span>.AUTHOR_PATTERN)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>        extracted_id <span class="op">=</span> <span class="va">self</span>._get_metadata(raw_text, <span class="va">self</span>.ID_PATTERN)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">int</span>(extracted_id) <span class="cf">if</span> extracted_id <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>        <span class="va">self</span>._content <span class="op">=</span> <span class="va">self</span>._get_content(raw_text)</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    <span class="kw">def</span> _get_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>        match <span class="op">=</span> re.search(<span class="va">self</span>.CONTENT_PATTERN, content, re.DOTALL)</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>filepath<span class="sc">}</span><span class="ss"> is not a valid Project Gutenberg Text file."</span>)</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    <span class="kw">def</span> _get_metadata(<span class="va">self</span>, content: <span class="bu">str</span>, pattern: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>        match <span class="op">=</span> re.search(pattern, content, re.MULTILINE)</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>    <span class="kw">def</span> _read(<span class="va">self</span>, file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">file</span>.read()</span></code></pre>
</div>
<p>We’ll also have another class for reading HTML files. This will be
similar to the ´´PlainTextDocument´´ class, but it will use the
´BeautifulSoup´ library to parse the HTML file and extract the content
and metadata. Rather than type out the entire class now, you can either
copy and paste the code below into a new file called ´html_document.py´,
or you can download the file from the <a href="">Workshop Resources
TODO</a>.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>´´´python import re</p>
<p>from bs4 import BeautifulSoup</p>
<p>from textanalysis_tool.document import Document</p>
<p>class HTMLDocument(Document): URL_PATTERN = “^<a href="https://www.gutenberg.org/files/" class="external-link uri">https://www.gutenberg.org/files/</a>([0-9]+)/.*”</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">@property</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">def</span> gutenberg_url<span class="er">(</span><span class="ex">self</span><span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> str <span class="kw">|</span> <span class="ex">None:</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="cf">if</span> <span class="ex">self.id:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="cf">return</span> <span class="ex">f</span><span class="st">"https://www.gutenberg.org/cache/epub/{self.id}/pg{self.id}-h.zip"</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">None</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">def</span> __init__<span class="er">(</span><span class="ex">self,</span> filepath: str<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="fu">super()</span><span class="ex">.__init__</span><span class="er">(</span><span class="va">filepath</span><span class="op">=</span>filepath<span class="kw">)</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="ex">raw_soup</span> = self._read<span class="er">(</span><span class="ex">self.filepath</span><span class="kw">)</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="ex">self.title</span> = self._get_metadata<span class="er">(</span><span class="ex">raw_soup,</span> <span class="st">"dc.title"</span><span class="kw">)</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="ex">self.author</span> = self._get_metadata<span class="er">(</span><span class="ex">raw_soup,</span> <span class="st">"dc.creator"</span><span class="kw">)</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="ex">url</span> = self._get_metadata<span class="er">(</span><span class="ex">raw_soup,</span> <span class="st">"dcterms.source"</span><span class="kw">)</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="ex">extracted_id</span> = re.search<span class="er">(</span><span class="ex">self.URL_PATTERN,</span> url, re.DOTALL<span class="kw">)</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    <span class="ex">self.id</span> = int<span class="er">(</span><span class="ex">extracted_id.group</span><span class="er">(</span><span class="ex">1</span><span class="kw">))</span> <span class="cf">if</span> <span class="ex">extracted_id.group</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span> <span class="cf">else</span> <span class="ex">None</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="ex">self._content</span> = self._get_content<span class="er">(</span><span class="ex">raw_soup</span><span class="kw">)</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="ex">def</span> _read<span class="er">(</span><span class="ex">self,</span> filepath<span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> BeautifulSoup:</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    <span class="ex">with</span> open<span class="er">(</span><span class="ex">filepath,</span> encoding=<span class="st">"utf-8"</span><span class="kw">)</span> <span class="fu">as</span> file_obj:</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>        <span class="ex">soup</span> = BeautifulSoup<span class="er">(</span><span class="ex">file_obj</span><span class="kw">)</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">soup</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="ex">def</span> _get_content<span class="er">(</span><span class="ex">self,</span> soup: BeautifulSoup<span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> str:</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="co"># Find the first h1 tag (The book title)</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    <span class="ex">title_h1</span> = soup.find<span class="er">(</span><span class="st">"h1"</span><span class="kw">)</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    <span class="co"># Collect all the content after the first h1</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>    <span class="ex">content</span> = []</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> title_h1.find_next_siblings<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>        <span class="ex">text</span> = element.get_text<span class="er">(</span><span class="va">strip</span><span class="op">=</span>True<span class="kw">)</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>        <span class="co"># Stop early if we hit this text, which indicate the end of the book</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"END OF THE PROJECT GUTENBERG EBOOK"</span> in text:</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>        <span class="cf">if</span> <span class="ex">text:</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>            <span class="ex">content.append</span><span class="er">(</span><span class="ex">text</span><span class="kw">)</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'\n\n'</span><span class="ex">.join</span><span class="er">(</span><span class="ex">content</span><span class="kw">)</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="ex">def</span> _get_metadata<span class="er">(</span><span class="ex">self,</span> soup: BeautifulSoup, tag_name: str<span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> str:</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">soup.find</span><span class="er">(</span><span class="st">"meta"</span><span class="ex">,</span> {<span class="st">"name"</span>: tag_name}<span class="kw">)</span><span class="ex">[</span><span class="st">"content"</span><span class="ex">]</span></span></code></pre>
</div>
<p>´´´</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="overriding-methods">Overriding Methods<a class="anchor" aria-label="anchor" href="#overriding-methods"></a>
</h3>
<p>Notice that in the <code>HTMLDocument</code> class, we have
overridden the <code>gutenberg_url</code> property to return the URL for
the HTML version of the book. This is an example of how we can override
methods and properties in a subclass to provide specialized behavior.
When we create an instance of <code>HTMLDocument</code>, it will use the
<code>gutenberg_url</code> property defined in the
<code>HTMLDocument</code> class, rather than the one defined in the
<code>Document</code> class.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>When overriding methods, it’s important to ensure that the new method
has the same signature as the method being overridden. This means that
the new method should have the same name, number of parameters, and
return type as the method being overridden.</p>
<p>Additionally, the <code>__init__</code> is technically also an
overridden method, since it is defined in the parent class. However,
since we are calling the parent class’s <code>__init__</code> method
using <code>super()</code>, we are not completely replacing the behavior
of the parent class’s <code>__init__</code> method, but rather extending
it. We can do the exact same thing with other methods if we want to add
some functionality to an existing method, rather than completely
replacing it.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="testing-our-inherited-classes">Testing our Inherited Classes<a class="anchor" aria-label="anchor" href="#testing-our-inherited-classes"></a>
</h3>
<p>Now let’s try out our classes. We already have the
<code>pg2680.txt</code> file in our ´scratch´ folder, now let’s download
the HTML version of the same book from Project Gutenberg. You can
download it from <a href="https://www.gutenberg.org/cache/epub/55317/pg55317-h.zip" class="external-link">this
link</a>. (Note that the file is zipped, as it also contains images. We
won’t be using the images, but you’ll need to unzip the file to get to
the HTML file.) Once you have the HTML file, place it in the ´scratch´
folder alongside the ´pg2680.txt´ file.</p>
<p>You can either copy and paste the code below into a new file called
<code>demo_inheritance.py</code>, or you can download the file from the
<a href="">Workshop Resources TODO</a>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"src"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.plain_text_document <span class="im">import</span> PlainTextDocument</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.html_document <span class="im">import</span> HTMLDocument</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># Test the PlainTextDocument class</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>plain_text_doc <span class="op">=</span> PlainTextDocument(filepath<span class="op">=</span><span class="st">"scratch/pg2680.txt"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document Title: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document Author: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span>author<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document ID: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document Line Count: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span>line_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document 'the' Occurrences: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span>get_word_occurrence(<span class="st">'the'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Plain Text Document Gutenberg URL: </span><span class="sc">{</span>plain_text_doc<span class="sc">.</span>gutenberg_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Type of Plain Text Document: </span><span class="sc">{</span><span class="bu">type</span>(plain_text_doc)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Parent Class: </span><span class="sc">{</span><span class="bu">type</span>(plain_text_doc)<span class="sc">.</span>__bases__[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co"># Test the HTMLDocument class</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>html_doc <span class="op">=</span> HTMLDocument(filepath<span class="op">=</span><span class="st">"scratch/pg2680-images.html"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document Title: </span><span class="sc">{</span>html_doc<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document Author: </span><span class="sc">{</span>html_doc<span class="sc">.</span>author<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document ID: </span><span class="sc">{</span>html_doc<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document Line Count: </span><span class="sc">{</span>html_doc<span class="sc">.</span>line_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document 'the' Occurrences: </span><span class="sc">{</span>html_doc<span class="sc">.</span>get_word_occurrence(<span class="st">'the'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HTML Document Gutenberg URL: </span><span class="sc">{</span>html_doc<span class="sc">.</span>gutenberg_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Type of HTML Document: </span><span class="sc">{</span><span class="bu">type</span>(html_doc)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Parent Class: </span><span class="sc">{</span><span class="bu">type</span>(html_doc)<span class="sc">.</span>__bases__[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co"># We can't use the Document class directly</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"scratch/pg2680.txt"</span>)</span></code></pre>
</div>
<p>You should get some output that looks like this:</p>
<pre><code>Plain Text Document Title: Meditations
Plain Text Document Author: Emperor of Rome Marcus Aurelius
Plain Text Document ID: 2680
Plain Text Document Line Count: 6845
Plain Text Document 'the' Occurrences: 5736
Plain Text Document Gutenberg URL: https://www.gutenberg.org/cache/epub/2680/pg2680.txt
Type of Plain Text Document: &lt;class 'textanalysis_tool.plain_text_document.PlainTextDocument'&gt;
Parent Class: &lt;class 'textanalysis_tool.document.Document'&gt;
========================================
HTML Document Title: Meditations
HTML Document Author: Marcus Aurelius, Emperor of Rome, 121-180
HTML Document ID: 2680
HTML Document Line Count: 5635
HTML Document 'the' Occurrences: 6161
HTML Document Gutenberg URL: https://www.gutenberg.org/cache/epub/2680/pg2680-h.zip
Type of HTML Document: &lt;class 'textanalysis_tool.html_document.HTMLDocument'&gt;
========================================
Parent Class: &lt;class 'textanalysis_tool.document.Document'&gt;
Traceback (most recent call last):
  File "E:\Projects\Python\scratch\textanalysis-tool\scratch\demo_inheritance.py", line 34, in &lt;module&gt;
    doc = Document(filepath="scratch/pg2680.txt")
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Projects\Python\scratch\textanalysis-tool\src\textanalysis_tool\document.py", line 14, in __init__
    self.content = self.get_content(filepath)
                   ^^^^^^^^^^^^^^^^
AttributeError: 'Document' object has no attribute 'get_content'</code></pre>
<p>Note that the end of the script results in an error - since the
<code>Document</code> class is no longer contains the
<code>get_content</code> or <code>get_metadata</code> methods, it cannot
be used directly. However we don’t get an error until we try to call one
of those methods.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>This is a use case for something called an abstract base class, which
is a class that is designed to be inherited from, but never instantiated
directly. One way to handle this would be to add these methods to the
<code>Document</code> class, but have them raise a
<code>NotImplementedError</code>. This way, if someone tries to
instantiate the <code>Document</code> class directly, they will get an
error indicating that maybe this class is not meant to be used
directly:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="kw">def</span> gutenberg_url(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">id</span>:</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"https://www.gutenberg.org/cache/epub/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">/pg</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="kw">def</span> line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>):</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> <span class="va">self</span>.get_content(filepath)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>        metadata <span class="op">=</span> <span class="va">self</span>.get_metadata(filepath)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> metadata.get(<span class="st">"title"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> metadata.get(<span class="st">"author"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> metadata.get(<span class="st">"id"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="st">"This method should be implemented by subclasses."</span>)</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>]:</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="st">"This method should be implemented by subclasses."</span>)</span></code></pre>
</div>
<p>Another way to handle this is to use the <code>abc</code> module from
the standard library, which provides a way to define abstract base
classes. This is a more formal way to define a class that is meant to be
inherited from, but not instantiated directly:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">class</span> Document(ABC):</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="kw">def</span> gutenberg_url(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">id</span>:</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"https://www.gutenberg.org/cache/epub/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">/pg</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="kw">def</span> line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>):</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> <span class="va">self</span>.get_content(filepath)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>        metadata <span class="op">=</span> <span class="va">self</span>.get_metadata(filepath)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> metadata.get(<span class="st">"title"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> metadata.get(<span class="st">"author"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> metadata.get(<span class="st">"id"</span>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>]:</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>        <span class="cf">pass</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="unit-testing">Unit Testing<a class="anchor" aria-label="anchor" href="#unit-testing"></a>
</h2>
<hr class="half-width">
<p>One of the first effects of this is that our <code>Document</code>
class is no longer directly testable, since it cannot be instantiated
directly. However, we can still test the <code>PlainTextDocument</code>
and <code>HTMLDocument</code> classes, which will also indirectly test
the <code>Document</code> class. You can either copy the code below into
two new files called <code>tests/test_plain_text_document.py</code> and
<code>tests/test_html_document.py</code>, or you can download the files
from the <a href="">Workshop Resources TODO</a>. (Also make sure to
delete the existing <code>tests/test_document.py</code> file, since it
is no longer applicable.)</p>
<p><code>tests/test_plain_text_document.py</code></p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> mock_open</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.plain_text_document <span class="im">import</span> PlainTextDocument</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>TEST_DATA <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="st">Title: Test Document</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="st">Author: Test Author</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="st">Release date: January 1, 2001 [eBook #1234]</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="st">                Most recently updated: February 2, 2002</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="st">*** START OF THE PROJECT GUTENBERG EBOOK TEST ***</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="st">This is a test document. It contains words.</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="st">It is only a test document.</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="st">*** END OF THE PROJECT GUTENBERG EBOOK TEST ***</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="at">@pytest.fixture</span>(autouse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="kw">def</span> mock_file(monkeypatch):</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span>TEST_DATA)</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    <span class="cf">return</span> mock</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="kw">def</span> doc():</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    <span class="cf">return</span> PlainTextDocument(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="kw">def</span> test_create_document(doc):</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>    <span class="cf">assert</span> doc.title <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>    <span class="cf">assert</span> doc.author <span class="op">==</span> <span class="st">"Test Author"</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(doc.<span class="bu">id</span>, <span class="bu">int</span>) <span class="kw">and</span> doc.<span class="bu">id</span> <span class="op">==</span> <span class="dv">1234</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="kw">def</span> test_empty_file(monkeypatch):</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>    <span class="co"># Mock an empty file</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>        PlainTextDocument(filepath<span class="op">=</span><span class="st">"empty_file.txt"</span>)</span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="kw">def</span> test_binary_file(monkeypatch):</span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>    <span class="co"># Mock a binary file</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">b"</span><span class="ch">\x00\x01\x02</span><span class="st">"</span>)</span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a>        PlainTextDocument(filepath<span class="op">=</span><span class="st">"binary_file.bin"</span>)</span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="kw">def</span> test_document_line_count(doc):</span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a>    <span class="cf">assert</span> doc.line_count <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a><span class="kw">def</span> test_document_word_occurrence(doc):</span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p><code>tests/test_html_document.py</code></p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> mock_open</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.html_document <span class="im">import</span> HTMLDocument</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>TEST_DATA <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="st">&lt;head&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="st">  &lt;meta name="dc.title" content="Test Document"&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="st">  &lt;meta name="dcterms.source" content="https://www.gutenberg.org/files/1234/1234-h/1234-h.htm"&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="st">  &lt;meta name="dc.creator" content="Test Author"&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="st">&lt;/head&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="st">&lt;body&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="st">  &lt;h1&gt;Test Document&lt;/h1&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="st">  &lt;p&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="st">    This is a test document. It contains words.</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="st">    It is only a test document.</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="st">  &lt;/p&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="at">@pytest.fixture</span>(autouse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="kw">def</span> mock_file(monkeypatch):</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span>TEST_DATA)</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>    <span class="cf">return</span> mock</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="kw">def</span> doc():</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>    <span class="cf">return</span> HTMLDocument(filepath<span class="op">=</span><span class="st">"tests/example_file.txt"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="kw">def</span> test_create_document(doc):</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>    <span class="cf">assert</span> doc.title <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>    <span class="cf">assert</span> doc.author <span class="op">==</span> <span class="st">"Test Author"</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(doc.<span class="bu">id</span>, <span class="bu">int</span>) <span class="kw">and</span> doc.<span class="bu">id</span> <span class="op">==</span> <span class="dv">1234</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="kw">def</span> test_empty_file(monkeypatch):</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>    <span class="co"># Mock an empty file</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>        HTMLDocument(filepath<span class="op">=</span><span class="st">"empty_file.html"</span>)</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a><span class="kw">def</span> test_document_line_count(doc):</span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a>    <span class="cf">assert</span> doc.line_count <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a><span class="kw">def</span> test_document_word_occurrence(doc):</span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-1-fixing-the-test" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-fixing-the-test" class="callout-inner">
<h3 class="callout-title">Challenge 1: Fixing the test</h3>
<div class="callout-content">
<p>When we run the tests, we get the following result:</p>
<pre><code>======================================= test session starts ========================================
platform win32 -- Python 3.11.11, pytest-8.4.2, pluggy-1.6.0
rootdir: E:\Projects\Python\scratch\textanalysis-tool
configfile: pyproject.toml
plugins: anyio-4.9.0
collected 11 items

tests\test_html_document.py .F..                                                              [ 36%]
tests\test_plain_text_document.py .....                                                       [ 81%]
tests\test_say_hello.py ..                                                                    [100%]

============================================= FAILURES =============================================
_________________________________________ test_empty_file __________________________________________

monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x000001FBDABE9390&gt;

    def test_empty_file(monkeypatch):
        # Mock an empty file
        mock = mock_open(read_data="")
        monkeypatch.setattr("builtins.open", mock)

        with pytest.raises(ValueError):
&gt;           HTMLDocument(filepath="empty_file.html")

tests\test_html_document.py:46:
 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src\textanalysis_tool\document.py:14: in __init__
    self.content = self.get_content(filepath)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = &lt;textanalysis_tool.html_document.HTMLDocument object at 0x000001FBDA8FE5D0&gt;, filepath = 'empty_file.html'

    def get_content(self, filepath) -&gt; str:
        soup = self.read(filepath)

        # Find the first h1 tag (The book title)
        title_h1 = soup.find("h1")

        # Collect all the content after the first h1
        content = []
&gt;       for element in title_h1.find_next_siblings():
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'NoneType' object has no attribute 'find_next_siblings'

src\textanalysis_tool\html_document.py:31: AttributeError
===================================== short test summary info ======================================
FAILED tests/test_html_document.py::test_empty_file - AttributeError: 'NoneType' object has no attribute 'find_next_siblings'
=================================== 1 failed, 10 passed in 0.28s ===================================</code></pre>
<p>Why is this happening? What do we need to change in the
<code>HTMLDocument</code> class to fix this?</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>The <code>open</code> function is being monkeypatched to return an
empty string, which is then passed to the <code>BeautifulSoup</code>
constructor. When <code>BeautifulSoup</code> is given an empty string,
it creates a <code>BeautifulSoup</code> object with no content.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The error is occurring because the <code>HTMLDocument</code> class is
trying to find the first <code>h1</code> tag in the HTML content, but
since the content is empty, there is no <code>h1</code> tag to find.
There are then no siblings to iterate over, which results in an
<code>AttributeError</code>.</p>
<p>We can fix this by adding similar <code>ValueError</code> checks in
the <code>HTMLDocument</code> class’s <code>read</code> method to ensure
that the file is not empty and is a valid HTML file:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> BeautifulSoup:</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> file_obj:</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>            soup <span class="op">=</span> BeautifulSoup(file_obj, features<span class="op">=</span><span class="st">"html.parser"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>        <span class="co"># Check that the file is parsable as HTML</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> soup:</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"The file could not be parsed as HTML."</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>        <span class="cf">return</span> soup</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Inheritance allows us to create a new class that is a specialized
version of an existing class</li>
<li>We can override methods and properties in a subclass to provide
specialized behavior</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-06-composition"><p>Content from <a href="06-composition.html">Inheritance and Composition</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/06-composition.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How does Composition differ from Inheritance?</li>
<li>When should I use Composition over Inheritance?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain the difference between Inheritance and Composition</li>
<li>Use Composition to build classes that contain instances of other
classes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="composition">Composition<a class="anchor" aria-label="anchor" href="#composition"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we saw how to use Inheritance to create a
specialized version of an existing class. But there’s another strategy
we can use to build classes: Composition. Composition is a design
principle where a class is composed of one or more objects from other
classes, rather than inheriting from them. This allows us to create
complex functionality by combining several smaller, simpler classes.</p>
<div class="section level3">
<h3 id="back-to-the-car-example">Back to the Car Example<a class="anchor" aria-label="anchor" href="#back-to-the-car-example"></a>
</h3>
<p>Let’s revisit our <code>Car</code> example from the Class Objects
episode. As a reminder, our class looked like this:</p>
<figure><img src="./fig/03-class-objects/car_class.PNG" alt="Car Class object example" class="figure mx-auto d-block"><div class="figcaption">Car Class object example</div>
</figure><p>But what if we wanted to add more functionality to our
<code>Car</code> class? For example, what if we wanted to differentiate
between cars that have different kinds of engines, like gasoline, or
electric? With the Inheritance approach, we would have to create a new
subclass for each type of engine, like this:</p>
<figure><img src="./fig/06-composition/car_inheritance.PNG" alt="Car Inheritance example" class="figure mx-auto d-block"><div class="figcaption">Car Inheritance example</div>
</figure><p>The code might look something like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">class</span> Car:</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>, fuel: <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>        <span class="va">self</span>.make <span class="op">=</span> make</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> model</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>        <span class="va">self</span>.year <span class="op">=</span> year</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> color</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>        <span class="va">self</span>.fuel <span class="op">=</span> fuel</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="kw">def</span> honk(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"beep"</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    <span class="kw">def</span> paint(<span class="va">self</span>, new_color: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> new_color</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="st">"Subclasses must implement this method"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="kw">class</span> CarGasEngine(Car)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>):</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(make, model, year, color, fuel<span class="op">=</span><span class="st">"gasoline"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>        <span class="cf">if</span> speed <span class="op">&lt;=</span> <span class="dv">10</span>:</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"put put put"</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>        <span class="cf">elif</span> speed <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"vrooom"</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="kw">class</span> CarElectricEngine(Car)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>):</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(make, model, year, color, fuel<span class="op">=</span><span class="st">"electric"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"hmmmmmm"</span></span></code></pre>
</div>
<p>But what happens if we start adding more kinds of engines? Or if our
engines start getting more complex, with different properties and
methods? Even worse, what if we want to add a new type of car component,
like <code>Wheels</code>? Do we now need to start creating subclasses
for every possible combination of car, engine, and wheels? We would end
up with a lot of subclasses, some of which might have extremely similar
(if not identical) functionality.</p>
<p>Instead, we can use a Compositional approach by making a new kind of
class called <code>Engine</code>, and then including an instance of that
class as a property of the <code>Car</code> class. This way, we can
create different kinds of engines as separate classes, and then use them
in our <code>Car</code> class without having to create a new subclass
for each one. Here’s how that would look:</p>
<figure><img src="./fig/06-composition/car_composition.PNG" alt="Car Composition example" class="figure mx-auto d-block"><div class="figcaption">Car Composition example</div>
</figure><div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">class</span> Car:</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, make: <span class="bu">str</span>, model: <span class="bu">str</span>, year: <span class="bu">int</span>, color: <span class="bu">str</span> <span class="op">=</span> <span class="st">"grey"</span>, engine: Engine <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="va">self</span>.make <span class="op">=</span> make</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> model</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="va">self</span>.year <span class="op">=</span> year</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> color</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="va">self</span>.engine <span class="op">=</span> engine</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="kw">def</span> honk(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"beep"</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="kw">def</span> paint(<span class="va">self</span>, new_color: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> new_color</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.engine:</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.engine.noise(speed)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Car must have an engine"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    <span class="kw">def</span> honk(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"beep"</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    <span class="kw">def</span> paint(<span class="va">self</span>, new_color: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>        <span class="va">self</span>.color <span class="op">=</span> new_color</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="st">"Subclasses must implement this method"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="kw">class</span> Engine:</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, fuel: <span class="bu">str</span>):</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>        <span class="va">self</span>.fuel <span class="op">=</span> fuel</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="st">"Subclasses must implement this method"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="kw">class</span> GasEngine(Engine):</span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(fuel<span class="op">=</span><span class="st">"gasoline"</span>)</span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>        <span class="cf">if</span> speed <span class="op">&lt;=</span> <span class="dv">10</span>:</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"put put put"</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>        <span class="cf">elif</span> speed <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"vrooom"</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="kw">class</span> ElectricEngine(Engine):</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(fuel<span class="op">=</span><span class="st">"electric"</span>)</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>    <span class="kw">def</span> noise(<span class="va">self</span>, speed: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"hmmmmmm"</span></span></code></pre>
</div>
<p>At first glance this might look even more complicated, but it has
several advantages:</p>
<ul>
<li>
<strong>Separation of Concerns</strong>: The <code>Engine</code>
class is responsible for engine-specific behavior, while the
<code>Car</code> class focuses on car-specific behavior. This makes the
code easier to understand and maintain.</li>
<li>
<strong>Reusability</strong>: The <code>Engine</code> class can be
reused in other contexts, such as in a <code>Truck</code> or
<code>Motorcycle</code> class, without duplicating code.</li>
<li>
<strong>Flexibility</strong>: We can easily add new types of engines
by creating new subclasses of <code>Engine</code>, without having to
modify the <code>Car</code> class or create new subclasses of
<code>Car</code>.</li>
</ul>
</div>
</section><section><h2 class="section-heading" id="refactoring-our-document-example">Refactoring our Document Example<a class="anchor" aria-label="anchor" href="#refactoring-our-document-example"></a>
</h2>
<hr class="half-width">
<p>Let’s take this concept and apply it to our <code>Document</code>
example from previous episodes. We can create a new class called
<code>Reader</code> that is responsible for reading files and providing
the content to the <code>Document</code> class. We can have a different
reader type for each file format we want to support.</p>
<p>To start with, let’s create a directory for our readers called
<code>readers</code>, and then create a base class called
<code>BaseReader</code> in a file called
<code>readers/base_reader.py</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">class</span> BaseReader(ABC):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>        <span class="cf">pass</span></span></code></pre>
</div>
<p>Then we’ll create a <code>TextReader</code> class in a file called
<code>readers/text_reader.py</code>. We’ll move over the logic for
reading and extracting content from a Project Gutenberg text file
here:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">from</span> readers.base_reader <span class="im">import</span> BaseReader</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="kw">class</span> TextReader(BaseReader):</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    TITLE_PATTERN <span class="op">=</span> <span class="vs">r"^Title:\s*(.*?)\s*$"</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    AUTHOR_PATTERN <span class="op">=</span> <span class="vs">r"^Author:\s*(.*?)\s*$"</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    ID_PATTERN <span class="op">=</span> <span class="vs">r"^Release date:\s*.*?\[eBook #(\d+)\]"</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    CONTENT_PATTERN <span class="op">=</span> <span class="vs">r"\*\*\* START OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> file_obj:</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>            <span class="cf">return</span> file_obj.read()</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="kw">def</span> _extract_metadata_element(<span class="va">self</span>, pattern: <span class="bu">str</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>        match <span class="op">=</span> re.search(pattern, text, re.MULTILINE)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>        match <span class="op">=</span> re.search(<span class="va">self</span>.CONTENT_PATTERN, raw_text, re.DOTALL)</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>            <span class="cf">return</span> match.group(<span class="dv">1</span>).strip()</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"File </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss"> is not a valid Project Gutenberg Text file."</span>)</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>        raw_text <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>        title <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.TITLE_PATTERN, raw_text)</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>        author <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.AUTHOR_PATTERN, raw_text)</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>        extracted_id <span class="op">=</span> <span class="va">self</span>._extract_metadata_element(<span class="va">self</span>.ID_PATTERN, raw_text)</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>            <span class="st">"title"</span>: title,</span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>            <span class="st">"author"</span>: author,</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>            <span class="st">"id"</span>: <span class="bu">int</span>(extracted_id) <span class="cf">if</span> extracted_id <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>        }</span></code></pre>
</div>
<p>Next, we’ll do the same for the HTML code. Create a file called
<code>readers/html_reader.py</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="im">from</span> .base_reader <span class="im">import</span> BaseReader</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="kw">class</span> HTMLReader(BaseReader):</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> BeautifulSoup:</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> file_obj:</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>            soup <span class="op">=</span> BeautifulSoup(file_obj, features<span class="op">=</span><span class="st">"html.parser"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> soup:</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"The file could not be parsed as HTML."</span>)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>        <span class="cf">return</span> soup</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>        soup <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>        <span class="co"># Find the first h1 tag (The book title)</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>        title_h1 <span class="op">=</span> soup.find(<span class="st">"h1"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>        <span class="co"># Collect all the content after the first h1</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>        content <span class="op">=</span> []</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>        <span class="cf">for</span> element <span class="kw">in</span> title_h1.find_next_siblings():</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>            text <span class="op">=</span> element.get_text(strip<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>            <span class="co"># Stop early if we hit this text, which indicate the end of the book</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"END OF THE PROJECT GUTENBERG EBOOK"</span> <span class="kw">in</span> text:</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>            <span class="cf">if</span> text:</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>                content.append(text)</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>.join(content)</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filename) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>        soup <span class="op">=</span> <span class="va">self</span>.read(filename)</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>        title <span class="op">=</span> soup.find(<span class="st">"meta"</span>, {<span class="st">"name"</span>: <span class="st">"dc.title"</span>})[<span class="st">"content"</span>]</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>        author <span class="op">=</span> soup.find(<span class="st">"meta"</span>, {<span class="st">"name"</span>: <span class="st">"dc.creator"</span>})[<span class="st">"content"</span>]</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>        url <span class="op">=</span> soup.find(<span class="st">"meta"</span>, {<span class="st">"name"</span>: <span class="st">"dcterms.source"</span>})[<span class="st">"content"</span>]</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>        extracted_id <span class="op">=</span> re.search(<span class="va">self</span>.URL_PATTERN, url, re.DOTALL)</span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>        <span class="bu">id</span> <span class="op">=</span> <span class="bu">int</span>(extracted_id.group(<span class="dv">1</span>)) <span class="cf">if</span> extracted_id.group(<span class="dv">1</span>) <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"title"</span>: title, <span class="st">"author"</span>: author, <span class="st">"id"</span>: <span class="bu">id</span>}</span></code></pre>
</div>
<p>Finally, we can update our <code>Document</code> class to use these
readers. We’ll add a new parameter to the <code>Document</code>
constructor called <code>reader</code>, which will be an instance of a
<code>BaseReader</code> subclass. Here’s how the updated
<code>Document</code> class might look:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.readers.base_reader <span class="im">import</span> BaseReader</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="kw">class</span> Document:</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="kw">def</span> gutenberg_url(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span> <span class="op">|</span> <span class="va">None</span>:</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.<span class="bu">id</span>:</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"https://www.gutenberg.org/cache/epub/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">/pg</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="kw">def</span> line_count(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.content.splitlines())</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filepath: <span class="bu">str</span>, reader: BaseReader):</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>        <span class="va">self</span>.filepath <span class="op">=</span> filepath</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> reader.get_content(filepath)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        metadata <span class="op">=</span> reader.get_metadata(filepath)</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>        <span class="va">self</span>.title <span class="op">=</span> metadata.get(<span class="st">"title"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>        <span class="va">self</span>.author <span class="op">=</span> metadata.get(<span class="st">"author"</span>)</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> metadata.get(<span class="st">"id"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>    <span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="key-points">Key Points<a class="anchor" aria-label="anchor" href="#key-points"></a>
</h2>
<hr class="half-width">
<p>Ok, that’s a lot of changes. So what was that all about?</p>
<ul>
<li>
<strong>Modularity</strong>: Our code is now made up of smaller,
more focused classes. The code responsible for reading files in and
parsing the contents is seperate from the code that represents a
document and provides analysis.</li>
<li>
<strong>Extensibility</strong>: We can easily add support for new
file formats by creating new reader classes that inherit from
<code>BaseReader</code>, without having to modify the
<code>Document</code> class.</li>
<li>
<strong>Maintainability</strong>: Each class has a single
responsibility, making it easier to understand and maintain.</li>
<li>
<strong>Reusability</strong>: The reader classes can be reused in
other contexts, such as in a different application that needs to read
and parse files.</li>
</ul>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Also note that in the <code>Document</code> class, in the
<code>__init__</code> method, the typehint for the <code>reader</code>
parameter is <code>BaseReader</code>. This means that any subclass of
<code>BaseReader</code> can be passed in, allowing for flexibility in
the type of reader used.</p>
<p>By using Inheritance and an abstract base class for the reader, we
are essentially creating a promise that any subclass of
<code>BaseReader</code> will implement the methods defined in the base
class. This is how we can safely call <code>reader.get_content()</code>
and <code>reader.get_metadata()</code> in the <code>Document</code>
class - we no longer care what specific type of reader it is, as long as
it adheres to the abstract base class interface.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="testing-the-new-objects">Testing the New Objects<a class="anchor" aria-label="anchor" href="#testing-the-new-objects"></a>
</h2>
<hr class="half-width">
<p>We can now delete our two inherited classes <code>DocumentText</code>
and <code>DocumentHTML</code>, and update our tests to use the new
<code>TextReader</code> and <code>HTMLReader</code> classes. This,
however means that we need to rewrite our tests to use the new
<code>Document</code> constructor, which requires a
<code>BaseReader</code> subclass instance.</p>
<p>Because of our new Compositional design, we can now test the
<code>Document</code> without a specific reader by using a mock reader.
This allows us to isolate the <code>Document</code> class and test its
functionality without relying on the actual file reading and parsing
logic:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.document <span class="im">import</span> Document</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.readers.base_reader <span class="im">import</span> BaseReader</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="kw">class</span> MockReader(BaseReader):</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"This is a test document. It contains words.</span><span class="ch">\n</span><span class="st">It is only a test document."</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>            <span class="st">"title"</span>: <span class="st">"Test Document"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>            <span class="st">"author"</span>: <span class="st">"Test Author"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>            <span class="st">"id"</span>: <span class="dv">1234</span>,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>        }</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="kw">def</span> test_create_document():</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"dummy_path.txt"</span>, reader<span class="op">=</span>MockReader())</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="cf">assert</span> doc.title <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    <span class="cf">assert</span> doc.author <span class="op">==</span> <span class="st">"Test Author"</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(doc.<span class="bu">id</span>, <span class="bu">int</span>) <span class="kw">and</span> doc.<span class="bu">id</span> <span class="op">==</span> <span class="dv">1234</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="kw">def</span> test_line_count():</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"dummy_path.txt"</span>, reader<span class="op">=</span>MockReader())</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    <span class="cf">assert</span> doc.line_count <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="kw">def</span> test_get_word_occurrence():</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    doc <span class="op">=</span> Document(filepath<span class="op">=</span><span class="st">"dummy_path.txt"</span>, reader<span class="op">=</span>MockReader())</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>    <span class="cf">assert</span> doc.get_word_occurrence(<span class="st">"test"</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>This time we are using a <code>MockReader</code> class that
implements the <code>BaseReader</code> interface. We could also use a
fixture here, but this is simpler for demonstration purposes.</p>
</div>
</div>
</div>
<div id="challenge-1-writing-tests-for-the-readers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-writing-tests-for-the-readers" class="callout-inner">
<h3 class="callout-title">Challenge 1: Writing Tests for the
Readers</h3>
<div class="callout-content">
<p>Now that we have our <code>TextReader</code> and
<code>HTMLReader</code> classes, we need to write tests for them. Create
a new directory called <code>tests/readers</code>, and then create two
new test files: <code>test_text_reader.py</code> and
<code>test_html_reader.py</code>. Write tests for the
<code>get_content</code> and <code>get_metadata</code> methods of each
reader based on our previous tests for the
<code>PlainTextDocument</code> and <code>HTMLDocument</code>
classes.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>tests/readers/test_text_reader.py</code></p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> mock_open</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.readers.text_reader <span class="im">import</span> TextReader</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>TEST_DATA <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="st">Title: Test Document</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="st">Author: Test Author</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="st">Release date: January 1, 2001 [eBook #1234]</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="st">                Most recently updated: February 2, 2002</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="st">*** START OF THE PROJECT GUTENBERG EBOOK TEST ***</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="st">This is a test document. It contains words.</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="st">It is only a test document.</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="st">*** END OF THE PROJECT GUTENBERG EBOOK TEST ***</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="at">@pytest.fixture</span>(autouse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="kw">def</span> mock_file(monkeypatch):</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span>TEST_DATA)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>    <span class="cf">return</span> mock</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="kw">def</span> test_get_content():</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>    reader <span class="op">=</span> TextReader()</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>    content <span class="op">=</span> reader.get_content(<span class="st">"dummy_path.txt"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"This is a test document."</span> <span class="kw">in</span> content</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"It is only a test document."</span> <span class="kw">in</span> content</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="kw">def</span> test_get_metadata():</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>    reader <span class="op">=</span> TextReader()</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>    metadata <span class="op">=</span> reader.get_metadata(<span class="st">"dummy_path.txt"</span>)</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"title"</span>] <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"author"</span>] <span class="op">==</span> <span class="st">"Test Author"</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"id"</span>] <span class="op">==</span> <span class="dv">1234</span></span></code></pre>
</div>
<p><code>tests/readers/test_html_reader.py</code></p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> mock_open</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.readers.html_reader <span class="im">import</span> HTMLReader</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>TEST_DATA <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="st">&lt;head&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="st">  &lt;meta name="dc.title" content="Test Document"&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="st">  &lt;meta name="dcterms.source" content="https://www.gutenberg.org/files/1234/1234-h/1234-h.htm"&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="st">  &lt;meta name="dc.creator" content="Test Author"&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="st">&lt;/head&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="st">&lt;body&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="st">  &lt;h1&gt;Test Document&lt;/h1&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="st">  &lt;p&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="st">    This is a test document. It contains words.</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="st">    It is only a test document.</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="st">  &lt;/p&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="at">@pytest.fixture</span>(autouse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="kw">def</span> mock_file(monkeypatch):</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    mock <span class="op">=</span> mock_open(read_data<span class="op">=</span>TEST_DATA)</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    monkeypatch.<span class="bu">setattr</span>(<span class="st">"builtins.open"</span>, mock)</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    <span class="cf">return</span> mock</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="kw">def</span> test_get_content():</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    reader <span class="op">=</span> HTMLReader()</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>    content <span class="op">=</span> reader.get_content(<span class="st">"dummy_path.html"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"This is a test document."</span> <span class="kw">in</span> content</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"It is only a test document."</span> <span class="kw">in</span> content</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="kw">def</span> test_get_metadata():</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>    reader <span class="op">=</span> HTMLReader()</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>    metadata <span class="op">=</span> reader.get_metadata(<span class="st">"dummy_path.html"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"title"</span>] <span class="op">==</span> <span class="st">"Test Document"</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"author"</span>] <span class="op">==</span> <span class="st">"Test Author"</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>    <span class="cf">assert</span> metadata[<span class="st">"id"</span>] <span class="op">==</span> <span class="dv">1234</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2-adding-a-new-reader" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-adding-a-new-reader" class="callout-inner">
<h3 class="callout-title">Challenge 2: Adding a New Reader</h3>
<div class="callout-content">
<p>We have one last filetype we haven’t added support for yet: Epub.
Create a new reader class for epub files called <code>EpubReader</code>
in a file called <code>readers/epub_reader.py</code>. You can use the
<code>ebooklib</code> package to read epub files. You can install it
with pip:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">uv</span> pip install Ebooklib</span></code></pre>
</div>
<p>You can refer to the <a href="https://docs.sourcefabric.org/projects/ebooklib/en/latest/tutorial.html" class="external-link">package
documentation here</a></p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>To get the metadata from an epub file, you can use the
<code>get_metadata</code> method of the <code>EpubBook</code> class.
Project Gutenberg uses the “Dublin Core” metadata standard, so the
namespace is “DC”.</p>
<p>Here’s an example of how to get the title:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>book.get_metadata(namespace<span class="op">=</span><span class="st">"DC"</span>, name<span class="op">=</span><span class="st">"title"</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span></code></pre>
</div>
<p>The <code>get_metadata</code> method returns a list of tuples, where
the first element is the value and the second element is the attributes,
so we need to access the first element of the first tuple to get the
actual title.</p>
<p>The other metadata fields we need are “creator” (author) and “source”
(id).</p>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>To get the content from an epub file, we can iterate over all of the
“items” in the book that are a document, then use
<code>BeautifulSoup</code> to extract the text from the HTML
content.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> book.get_items_of_type(ebooklib.ITEM_DOCUMENT):</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(item.get_content(), features<span class="op">=</span><span class="st">"html.parser"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    text <span class="op">=</span> soup.get_text()</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="co"># Do something with the text</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="im">import</span> ebooklib</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="im">from</span> textanalysis_tool.readers.base_reader <span class="im">import</span> BaseReader</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="kw">class</span> EPUBReader(BaseReader):</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    SOURCE_URL_PATTERN <span class="op">=</span> <span class="st">"https://www.gutenberg.org/files/([0-9]+)/[0-9]+-h/[0-9]+-h.htm"</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="kw">def</span> read(<span class="va">self</span>, filepath: <span class="bu">str</span>) <span class="op">-&gt;</span> ebooklib.epub.EpubBook:</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>        book <span class="op">=</span> ebooklib.epub.read_epub(filepath)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> book:</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"The file could not be parsed as EPUB."</span>)</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>        <span class="cf">return</span> book</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath):</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>        book <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>        text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>        <span class="cf">for</span> section <span class="kw">in</span> book.get_items_of_type(ebooklib.ITEM_DOCUMENT):</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>            content <span class="op">=</span> section.get_content()</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>            soup <span class="op">=</span> BeautifulSoup(content, features<span class="op">=</span><span class="st">"html.parser"</span>)</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>            text <span class="op">+=</span> soup.get_text()</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>        <span class="cf">return</span> text</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>    <span class="kw">def</span> get_metadata(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>        book <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>        source_url <span class="op">=</span> book.get_metadata(namespace<span class="op">=</span><span class="st">"DC"</span>, name<span class="op">=</span><span class="st">"source"</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>        extracted_id <span class="op">=</span> re.search(<span class="va">self</span>.SOURCE_URL_PATTERN, source_url, re.DOTALL).group(<span class="dv">1</span>)</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>        metadata <span class="op">=</span> {</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>            <span class="st">"title"</span>: book.get_metadata(namespace<span class="op">=</span><span class="st">"DC"</span>, name<span class="op">=</span><span class="st">"title"</span>)[<span class="dv">0</span>][<span class="dv">0</span>],</span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>            <span class="st">"author"</span>: book.get_metadata(namespace<span class="op">=</span><span class="st">"DC"</span>, name<span class="op">=</span><span class="st">"creator"</span>)[<span class="dv">0</span>][<span class="dv">0</span>],</span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>            <span class="st">"extracted_id"</span>: <span class="bu">int</span>(extracted_id) <span class="cf">if</span> extracted_id <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a>        }</span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>        <span class="cf">return</span> metadata</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Composition allows us to build complex functionality by combining
several smaller, simpler classes</li>
<li>Composition promotes separation of concerns, reusability,
flexibility, and maintainability</li>
<li>By using abstract base classes, we can define interfaces that
subclasses must implement, allowing for flexibility in our code
design</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-07-static-code-analysis"><p>Content from <a href="07-static-code-analysis.html">Static Code Analysis</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/07-static-code-analysis.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-static-code-analysis">What is Static Code Analysis?<a class="anchor" aria-label="anchor" href="#what-is-static-code-analysis"></a>
</h2>
<hr class="half-width">
<p>Static code analysis tools are programs or scripts that analyze
source code without executing it in order to identify potential issues,
bugs, or code smells. These tools can help developers improve code
quality, maintainability, and adherence to coding standards.</p>
<p>We’re going to look at two static code analysis tools in this
episode: <code>ruff</code> and <code>mypy</code>.</p>
<p>Each of these tools can be run from the command line, and they can
also be integrated into your development workflow, such as in your text
editor, as a pre-commit hook, or in your continuous integration (CI)
pipeline.</p>
</section><section><h2 class="section-heading" id="ruff">Ruff<a class="anchor" aria-label="anchor" href="#ruff"></a>
</h2>
<hr class="half-width">
<p><a href="https://docs.astral.sh/ruff/" class="external-link">Ruff</a> is a fast Python
linter and code formatter that takes over the roles of several other
tools, including <code>flake8</code>, <code>pylint</code>, and
<code>isort</code>.</p>
<p>We can install <code>ruff</code> as a development dependency using
<code>uv</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">uv</span> add ruff <span class="at">--dev</span></span></code></pre>
</div>
<p>We can then run <code>ruff</code> on our codebase to identify any
issues:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">uv</span> run ruff check .</span></code></pre>
</div>
<p>Did you get any output? Depending on your IDE and it’s settings, you
might have already fixed some of the issues.</p>
<p>The default configuration for <code>ruff</code> only checks for a few
types of issues. We can customize the configuration by adding a section
for <code>ruff</code> in our <code>pyproject.toml</code> file:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">[tool.ruff]</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># Exclude specific files and directories from ruff</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="dt">exclude</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="st">".venv"</span><span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="st">"__init__.py"</span><span class="op">,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="dt">line-length</span> <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="dt">indent-width</span> <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="kw">[tool.ruff.format]</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="dt">quote-style</span> <span class="op">=</span> <span class="st">"double"</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="dt">indent-style</span> <span class="op">=</span> <span class="st">"space"</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="dt">skip-magic-trailing-comma</span> <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="dt">line-ending</span> <span class="op">=</span> <span class="st">"auto"</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="kw">[tool.ruff.lint]</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co"># Enable specific linting rules</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co"># - "D": Docstring-related rules (Not included for this workshop)</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co"># - "E", "W": PEP8 style errors</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co"># - "F": Flake8 compatibility</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co"># - "I": Import-related rules (isort)</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co"># - "B": Bugbear (Extended pycodesyle checks)</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co"># - "PL": Pylint compatibility</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co"># - "C90": McCabe complexity checks (identify code with large numbers of paths - should be refactored)</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co"># - "N": Naming conventions for classes, functions, variables, etc.</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co"># - "ERA": Remove commented out code</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co"># - "RUF": Ruff-specific rules</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co"># - "TID": Tidy Imports</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="dt">select</span> <span class="op">=</span> <span class="op">[</span><span class="st">"E"</span><span class="op">,</span> <span class="st">"W"</span><span class="op">,</span> <span class="st">"F"</span><span class="op">,</span> <span class="st">"I"</span><span class="op">,</span> <span class="st">"B"</span><span class="op">,</span> <span class="st">"PL"</span><span class="op">,</span> <span class="st">"C90"</span><span class="op">,</span> <span class="st">"N"</span><span class="op">,</span> <span class="st">"ERA"</span><span class="op">,</span> <span class="st">"RUF"</span><span class="op">,</span> <span class="st">"TID"</span><span class="op">,</span> <span class="st">"SIM"</span><span class="op">]</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co"># These are Personal preference</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co"># D203 - Don't require a space between the docstring and the class or function definition</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co"># D212 - The summary of the docstring can go on the line below the triple quotes</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="dt">ignore</span> <span class="op">=</span> <span class="op">[</span><span class="st">"D203"</span><span class="op">,</span> <span class="st">"D212"</span><span class="op">]</span></span></code></pre>
</div>
<p>This configuration adds a number of additional rules to check for.
This is the output from running this one on our codebase:</p>
<pre><code>I001 [*] Import block is un-sorted or un-formatted
 --&gt; src\textanalysis_tool\readers\epub_reader.py:1:1
  |
1 | / import re
2 | |
3 | | from bs4 import BeautifulSoup
4 | | import ebooklib
5 | |
6 | | from textanalysis_tool.readers.base_reader import BaseReader
  | |____________________________________________________________^
  |
help: Organize imports

E501 Line too long (136 &gt; 100)
  --&gt; src\textanalysis_tool\readers\text_reader.py:10:101
   |
 8 | …
 9 | …)\]"
10 | …GUTENBERG EBOOK .*? \*\*\*(.*?)\*\*\* END OF THE PROJECT GUTENBERG EBOOK .*? \*\*\*"
   |                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 | …
12 | …
   |

I001 [*] Import block is un-sorted or un-formatted
 --&gt; tests\readers\test_html_reader.py:1:1
  |
1 | / import pytest
2 | | from unittest.mock import mock_open
3 | |
4 | | from textanalysis_tool.readers.html_reader import HTMLReader
  | |____________________________________________________________^
5 |
6 |   TEST_DATA = """
  |
help: Organize imports

PLR2004 Magic value used in comparison, consider replacing `1234` with a constant variable
  --&gt; tests\readers\test_html_reader.py:41:30
   |
39 |     assert metadata["title"] == "Test Document"
40 |     assert metadata["author"] == "Test Author"
41 |     assert metadata["id"] == 1234
   |                              ^^^^
   |

I001 [*] Import block is un-sorted or un-formatted
 --&gt; tests\readers\test_text_reader.py:1:1
  |
1 | / import pytest
2 | | from unittest.mock import mock_open
3 | |
4 | | from textanalysis_tool.readers.text_reader import TextReader
  | |____________________________________________________________^
5 |
6 |   TEST_DATA = """
  |
help: Organize imports

PLR2004 Magic value used in comparison, consider replacing `1234` with a constant variable
  --&gt; tests\readers\test_text_reader.py:40:30
   |
38 |     assert metadata["title"] == "Test Document"
39 |     assert metadata["author"] == "Test Author"
40 |     assert metadata["id"] == 1234
   |                              ^^^^
   |

PLR2004 Magic value used in comparison, consider replacing `1234` with a constant variable
  --&gt; tests\test_document.py:21:50
   |
19 |     assert doc.title == "Test Document"
20 |     assert doc.author == "Test Author"
21 |     assert isinstance(doc.id, int) and doc.id == 1234
   |                                                  ^^^^
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --&gt; tests\test_document.py:26:30
   |
24 | def test_line_count():
25 |     doc = Document(filepath="dummy_path.txt", reader=MockReader())
26 |     assert doc.line_count == 2
   |                              ^
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --&gt; tests\test_document.py:31:47
   |
29 | def test_get_word_occurrence():
30 |     doc = Document(filepath="dummy_path.txt", reader=MockReader())
31 |     assert doc.get_word_occurrence("test") == 2
   |                                               ^
   |

Found 9 errors.
[*] 3 fixable with the `--fix` option.</code></pre>
<div class="section level3">
<h3 id="auto-fixing-issues">Auto-fixing Issues<a class="anchor" aria-label="anchor" href="#auto-fixing-issues"></a>
</h3>
<p>You notice right away that the end of the message says that 3 of the
issues are fixable with the <code>--fix</code> option. We can run
<code>ruff</code> again with this option to automatically fix these
issues:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">uv</span> run ruff check . <span class="at">--fix</span></span></code></pre>
</div>
<p>Ruff will automatically fix issues that have very clear solutions,
such as sorting imports and fixing spacing. This command will modify
your source files, so be sure to review the changes just in case, but it
should never modify the logic of your code.</p>
</div>
<div class="section level3">
<h3 id="ignoring-files-and-rules">Ignoring Files and Rules<a class="anchor" aria-label="anchor" href="#ignoring-files-and-rules"></a>
</h3>
<p>Some of the issues reported by <code>ruff</code> don’t really make
sense for our project. For example, it is complaining about “magic
numbers” in our tests. These are numbers that appear directly in the
code without being assigned to a named constant. In tests, this is often
fine, since the numbers are used in a clear context, and assigning them
to a constant variable would just add unnecessary complexity.</p>
<p>We can tell <code>ruff</code> to ignore specific rules for specific
files or directories. We already have an example of this in our
<code>pyproject.toml</code> file, where we tell <code>ruff</code> to
ignore the <code>__init__.py</code> files in our codebase. We can add
the following to ignore the magic number rule (<code>PLR2004</code>) in
our tests directory:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Ignore magic number rule in tests</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="kw">[tool.ruff.lint.per-file-ignores]</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="dt">"tests/**"</span> <span class="op">=</span> <span class="op">[</span><span class="st">"PLR2004"</span><span class="op">]</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="docstrings">Docstrings<a class="anchor" aria-label="anchor" href="#docstrings"></a>
</h2>
<hr class="half-width">
<p>We we had removed the check for docstrings (<code>D</code>) from our
<code>ruff</code> configuration, but let’s just re-enable it for a
moment to see what it reports and how to fix it.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="cf">select</span> <span class="ex">=</span> [<span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"W"</span>, <span class="st">"F"</span>, <span class="st">"I"</span>, <span class="st">"B"</span>, <span class="st">"PL"</span>, <span class="st">"C90"</span>, <span class="st">"N"</span>, <span class="st">"ERA"</span>, <span class="st">"RUF"</span>, <span class="st">"TID"</span>, <span class="st">"SIM"</span>]</span></code></pre>
</div>
<p>To run <code>ruff</code> on a single file, we can specify the file
path instead of a directory:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">uv</span> run ruff check src/textanalysis_tool/document.py</span></code></pre>
</div>
<p>It looks like we get six errors, all related to missing
docstrings.</p>
<div class="section level3">
<h3 id="what-exactly-is-a-docstring">What exactly is a docstring?<a class="anchor" aria-label="anchor" href="#what-exactly-is-a-docstring"></a>
</h3>
<p>A docstring is a special type of comment that is used to document a
module, class, method, or function in Python. Docstrings are written
using triple quotes (<code>"""</code>) and are placed immediately after
the definition of the module, class, method, or function they are
documenting.</p>
<p>There are several different styles for writing docstrings:</p>
<ul>
<li><a href="https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings" class="external-link">Google
Style</a></li>
<li><a href="https://numpydoc.readthedocs.io/en/latest/format.html" class="external-link">NumPy
Style</a></li>
<li><a href="https://peps.python.org/pep-0287/" class="external-link">reStructuredText (reST)
Style</a></li>
</ul>
<p>The choice of style often depends on the conventions used in a
particular project or organization.</p>
<p>Let’s stick with the Google style for this project. Here’s an example
of a docstring for one of the functions in our <code>Document</code>
class:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">def</span> get_word_occurrence(<span class="va">self</span>, word: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">    Count the number of occurrences of the given word in the document content.</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">        word (str): The word to count occurrences of.</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">        int: The number of occurrences of the word in the document content.</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.content.lower().count(word.lower())</span></code></pre>
</div>
<p>We can see that the Docstring is made up of different sections:</p>
<ul>
<li>A brief summary of what the function does</li>
<li>An <code>Args</code> section that describes the function’s
parameters</li>
<li>A <code>Returns</code> section that describes what the function
returns</li>
</ul>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Docstrings are not interpreted by python, so don’t affect the runtime
behavior of your code. They are primarily for documentation purposes,
and can be accessed using the built-in <code>help()</code> function.</p>
</div>
</div>
</div>
<p>Running the <code>ruff</code> command again shows that we have fixed
one of the issues in this file.</p>
<div id="challenge-1-docstrings-for-the-document-class" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-docstrings-for-the-document-class" class="callout-inner">
<h3 class="callout-title">Challenge 1: Docstrings for the Document
Class</h3>
<div class="callout-content">
<p>Add a docstring for the <code>document.py</code> module, the
<code>Document</code> class, and the <code>__init__</code> method of the
<code>Document</code> class. Make sure to include a brief summary, as
well as <code>Args</code> and <code>Returns</code> sections where
appropriate.</p>
<p>Refer to the <a href="https://google.github.io/styleguide/pyguide.html#s3.8.2-comments-in-modules" class="external-link">Google
Style Guide - Comments in Modules</a> section for guidance.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="mypy">Mypy<a class="anchor" aria-label="anchor" href="#mypy"></a>
</h2>
<hr class="half-width">
<p>One of the common complaints about Python is that it is a dynamically
typed language, which can lead to type-related errors that are only
caught at runtime. To help mitigate this, Python supports type hints,
which allow developers to specify the expected types of variables,
function parameters, and return values.</p>
<p>We’ve been using type hints all along in this project, but as these
are only used by the IDE and the user, there’s no guarantee that the
types are actually correct. This is where <code>mypy</code> comes
in.</p>
<p>We can install <code>mypy</code> as a development dependency using
<code>uv</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">uv</span> add mypy <span class="at">--dev</span></span></code></pre>
</div>
<p>Then run it on our codebase:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">uv</span> run mypy src</span></code></pre>
</div>
<p>Your output might look something like this:</p>
<pre><code>src\textanalysis_tool\readers\html_reader.py:28: error: Item "None" of "PageElement | None" has no attribute "find_next_siblings"  [union-attr]
src\textanalysis_tool\readers\html_reader.py:40: error: Return type "str" of "get_metadata" incompatible with return type "dict[Any, Any]" in supertype "textanalysis_tool.readers.base_reader.BaseReader"  [override]
src\textanalysis_tool\readers\html_reader.py:43: error: Value of type "PageElement | None" is not indexable  [index]
src\textanalysis_tool\readers\html_reader.py:44: error: Value of type "PageElement | None" is not indexable  [index]
src\textanalysis_tool\readers\html_reader.py:45: error: Value of type "PageElement | None" is not indexable  [index]
src\textanalysis_tool\readers\html_reader.py:47: error: Item "None" of "Match[str] | None" has no attribute "group"  [union-attr]
src\textanalysis_tool\readers\html_reader.py:49: error: Incompatible return value type (got "dict[str, Any]", expected "str")  [return-value]
src\textanalysis_tool\readers\epub_reader.py:3: error: Skipping analyzing "ebooklib": module is installed, but missing library stubs or py.typed marker  [import-untyped]
src\textanalysis_tool\readers\epub_reader.py:3: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
src\textanalysis_tool\readers\epub_reader.py:31: error: Item "None" of "Match[str] | None" has no attribute "group"  [union-attr]
Found 9 errors in 2 files (checked 7 source files)</code></pre>
<p>These errors are slightly more complex than the ones reported by
<code>ruff</code>, but they are also very useful, as the often point to
places where our code might not handle all of the possible cases
correctly.</p>
<div class="section level3">
<h3 id="fixing-mypy-errors">Fixing Mypy Errors<a class="anchor" aria-label="anchor" href="#fixing-mypy-errors"></a>
</h3>
<p>MyPy Errors can be a bit tricky to understand, as they often involve
a more complex analysis of the code than <code>ruff</code>.</p>
<p>For example, the first error is telling us that we are trying to
access the <code>find_next_siblings</code> method on an object that
could be <code>None</code>. This is a potential bug, as if the object is
<code>None</code>, this will raise an <code>AttributeError</code> at
runtime.</p>
<p>Looking at the project code, the issue is in the
<code>HTMLReader</code> class, in the <code>get_content</code>
method:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>        soup <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>        <span class="co"># Find the first h1 tag (The book title)</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>        title_h1 <span class="op">=</span> soup.find(<span class="st">"h1"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>        <span class="co"># Collect all the content after the first h1</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        content <span class="op">=</span> []</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>        <span class="cf">for</span> element <span class="kw">in</span> title_h1.find_next_siblings():</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>            text <span class="op">=</span> element.get_text(strip<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>            <span class="co"># Stop early if we hit this text, which indicate the end of the book</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"END OF THE PROJECT GUTENBERG EBOOK"</span> <span class="kw">in</span> text:</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>            <span class="cf">if</span> text:</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>                content.append(text)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>.join(content)</span></code></pre>
</div>
<p>The <code>soup.find("h1")</code> call will return <code>None</code>
if no <code>h1</code> tag is found in the HTML document. We should
probably add a check for this case and raise a more informative error
message.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>    <span class="kw">def</span> get_content(<span class="va">self</span>, filepath) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>        soup <span class="op">=</span> <span class="va">self</span>.read(filepath)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>        <span class="co"># Find the first h1 tag (The book title)</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>        title_h1 <span class="op">=</span> soup.find(<span class="st">"h1"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>        <span class="cf">if</span> title_h1 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"No &lt;h1&gt; tag found in the HTML document: </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        <span class="co"># Collect all the content after the first h1</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        content <span class="op">=</span> []</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>        <span class="cf">for</span> element <span class="kw">in</span> title_h1.find_next_siblings():</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>            text <span class="op">=</span> element.get_text(strip<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>            <span class="co"># Stop early if we hit this text, which indicate the end of the book</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"END OF THE PROJECT GUTENBERG EBOOK"</span> <span class="kw">in</span> text:</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>            <span class="cf">if</span> text:</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>                content.append(text)</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>.join(content)</span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Note that we don’t have to actually change the code in the for loop,
as <code>mypy</code> is smart enough to understand that if
<code>title_h1</code> is none, then the <code>ValueError</code> will be
raised, and the code following it will not be executed.</p>
</div>
</div>
</div>
<div id="challenge-1-fix-a-mypy-error" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-fix-a-mypy-error" class="callout-inner">
<h3 class="callout-title">Challenge 1: Fix a Mypy Error</h3>
<div class="callout-content">
<p>Another error we get is related to the <code>get_metadata</code>
method in the same class:</p>
<pre><code>src\textanalysis_tool\readers\html_reader.py:45: error: Value of type "PageElement | None" is not indexable  [index]
src\textanalysis_tool\readers\html_reader.py:46: error: Value of type "PageElement | None" is not indexable  [index]
src\textanalysis_tool\readers\html_reader.py:47: error: Value of type "PageElement | None" is not indexable  [index]</code></pre>
<p>Why is this error being reported? What can we do to fix it? (There’s
actually two issues here! One is a more specific
<code>BeautifulSoup</code> issue, and the other is a more general Python
issue.)</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>Values in python dictionaries can be accessed in two ways:</p>
<ul>
<li>Using the indexing syntax: <code>value = my_dict[key]</code>
</li>
<li>Using the <code>get</code> method:
<code>value = my_dict.get(key)</code>
</li>
</ul>
<p>The indexing syntax will raise a <code>KeyError</code> if the key is
not found in the dictionary, while the <code>get</code> method will
return <code>None</code> (or a default value if provided) if the key is
not found.</p>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>There are several kinds of values that can be returned from a
<code>BeautifulSoup.find</code> call, and we can’t really be certain of
which type we will get back. It could be a <code>Tag</code>, a
<code>NavigableString</code>, a <code>PageElement</code>, or
<code>None</code>.</p>
<p>There is an alternative method called <code>select_one</code> that
can be used to find elements using plain CSS selectors, and it always
returns either a <code>Tag</code> or <code>None</code>, which lets us
avoid some of the complexity of dealing with multiple possible
types.</p>
<p><code>soup.find("meta", {"name": "dc.title"})</code> can be replaced
with <code>soup.select_one('meta[name="dc.title"]')</code></p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>MyPy is pointing out that we are using the indexing syntax to access
values in a dictionary, but given the way we are pulling the data out of
the text, it is possible that the key might not even be present in the
dictionary.</p>
<p>We can fix this by using the <code>get</code> method instead, and
providing a default value of <code>None</code> if the key is not
found.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>title_element <span class="op">=</span> soup.select_one(<span class="st">'meta[name="dc.title"]'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>title <span class="op">=</span> title_element.get(<span class="st">"content"</span>) <span class="cf">if</span> title_element <span class="cf">else</span> <span class="st">"Unknown Title"</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>author_element <span class="op">=</span> soup.select_one(<span class="st">'meta[name="dc.creator"]'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>author <span class="op">=</span> author_element.get(<span class="st">"content"</span>) <span class="cf">if</span> author_element <span class="cf">else</span> <span class="st">"Unknown Author"</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>url_element <span class="op">=</span> soup.select_one(<span class="st">'meta[name="dcterms.source"]'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>url <span class="op">=</span> url_element.get(<span class="st">"content"</span>) <span class="cf">if</span> url_element <span class="cf">else</span> <span class="st">"Unknown URL"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2-fixing-other-mypy-errors" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-fixing-other-mypy-errors" class="callout-inner">
<h3 class="callout-title">Challenge 2: Fixing Other Mypy Errors</h3>
<div class="callout-content">
<p>You should have at least one other mypy error in the
<code>HTMLReader</code> class. Can you find it and fix it? Do you have
any other mypy errors in other parts of the codebase? If so, can you fix
those as well?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>It will depend on your code!</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-08-building-and-deploying"><p>Content from <a href="08-building-and-deploying.html">Building and Deploying a Package</a></p>
<hr>
<p>Last updated on 2025-09-15 |

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/episodes/08-building-and-deploying.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we build and deploy our project as a package?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Deploy our project locally as a python package</li>
<li>Set up Github Actions to automatically build and deploy our
package</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="building-locally">Building Locally<a class="anchor" aria-label="anchor" href="#building-locally"></a>
</h2>
<hr class="half-width">
<p>Since we have been using <code>uv</code> all along and have our
<code>pyproject.toml</code> set up, building our package is as simple as
running:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">uv</span> build</span></code></pre>
</div>
<p>You should see some output that looks like this:</p>
<pre><code>Building source distribution...
Building wheel from source distribution...
Successfully built dist\textanalysis_tool-0.1.0.tar.gz
Successfully built dist\textanalysis_tool-0.1.0-py3-none-any.whl</code></pre>
<p>And a new directory called <code>dist/</code> should appear in your
project folder. Inside that directory, you should see two files:</p>
<ul>
<li>
<code>textanalysis_tool-0.1.0-py3-none-any.whl</code>: This is the
wheel file, which is a built package that can be installed.</li>
<li>
<code>textanalysis_tool-0.1.0.tar.gz</code>: This is the source
distribution, which contains the source code of your package.</li>
</ul>
<div class="section level3">
<h3 id="what-exactly-are-these-files">What Exactly are these files?<a class="anchor" aria-label="anchor" href="#what-exactly-are-these-files"></a>
</h3>
<p>A Wheel file is a built package that can be installed using pip. It
contains all the necessary files for your package to run, including
compiled code if applicable. Wheels are the preferred format for Python
packages because they are faster to install and can include pre-compiled
binaries.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Why is it called a “wheel”?</p>
<p>The term “wheel” is used because the original name for PyPi was
“cheese shop” (a reference to a Monty Python sketch), and a wheel of
cheese is a common image associated with cheese shops.</p>
</div>
</div>
</div>
<p>The source distribution is a tarball that contains the source code of
your package. You can open it with a tool like <code>tar</code> or
<code>7-Zip</code> to see the contents. It includes all the files needed
to build and install your package, including the
<code>pyproject.toml</code> file and any other source files.</p>
</div>
</section><section><h2 class="section-heading" id="github-actions">GitHub Actions<a class="anchor" aria-label="anchor" href="#github-actions"></a>
</h2>
<hr class="half-width">
<p>Building the package locally is great for testing, but what we
actually want is to have our package built and automatically deployed
from GitHub, so that anyone using our package can always get the latest
version. GitHub Actions is a tool that allows us to automate tasks in
our GitHub repository by configuring a workflow using a YAML file.</p>
<div class="section level3">
<h3 id="setting-up-the-workflow">Setting Up the Workflow<a class="anchor" aria-label="anchor" href="#setting-up-the-workflow"></a>
</h3>
<p>In your project, create a new directory called
<code>.github/workflows/</code>. Inside that directory, create a new
file called <code>build.yml</code>. This file will contain the
configuration for our GitHub Actions workflow.</p>
<p>Here is the <code>build.yml</code> file we will use:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Deploy Package</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'[0-9]+.[0-9]+.[0-9]+*'</span><span class="co"> # Deploy when we tag with a semantic version</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="co"> # Use the most up-to-date Ubuntu runner</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> write</span><span class="co">  # Required to create releases</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span><span class="co"> # Check out the repository</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">    # Create a Python environment</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Python</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="at">        </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.11'</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">    # Install uv</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install uv</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> astral-sh/setup-uv@v3</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">    # Build the package</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Package</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv build</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">    # Upload the built package to the repository as an artifact</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload Artifacts</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> textanalysis-tool</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> dist/</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">    # Create GitHub Release with artifacts</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Create Release</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> softprops/action-gh-release@v1</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="at">        </span><span class="fu">files</span><span class="kw">:</span><span class="at"> dist/*</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="at">        </span><span class="fu">generate_release_notes</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="at">        </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">    # Publish to TestPyPI</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Publish to TestPyPI</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>        uv publish --publish-url https://test.pypi.org/legacy/ --username __token__ --password ${{ secrets.TEST_PYPI_API_TOKEN }}</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="setting-up-pypi">Setting up PyPI<a class="anchor" aria-label="anchor" href="#setting-up-pypi"></a>
</h3>
<p>Because we are not ready to publish our package to the main PyPI
repository, we will use TestPyPI, which is a separate instance of the
Python Package Index that allows you to test package publishing and
installation without affecting the real PyPI.</p>
<p>For this you will need to have an account on TestPyPI with 2-Factor
enabled. You can create an account at <a href="https://test.pypi.org/account/register/" class="external-link uri">https://test.pypi.org/account/register/</a>.</p>
<p>Once your account is set up, go to your account settings and create
an API token with the name <code>github-actions</code>. Copy the token
to your clipboard.</p>
<p>Next, we need to store the token in our GitHub repository as a
secret. Go to your repository on GitHub, click on “Settings”, then
“Secrets and variables”, and then “Actions”. Click on “New repository
secret” and name it <code>TEST_PYPI_API_TOKEN</code>. Paste your token
into the “Value” field and click “Add secret”.</p>
</div>
<div class="section level3">
<h3 id="triggering-the-workflow">Triggering the Workflow<a class="anchor" aria-label="anchor" href="#triggering-the-workflow"></a>
</h3>
<p><code>git add</code>, <code>git commit</code>, and
<code>git push</code> this file to your repository. You should see a new
“Actions” tab in your GitHub repository. Click on it, and you should see
your workflow listed there:</p>
<figure><img src="./fig/08-building-and-deploying/new_actions.PNG.jpg" alt="GitHub Actions Tab with a Workflow" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions &amp; Workflow</div>
</figure><p>But nothing has run yet! This is because we have configured our
workflow to only run when we push a tag that follows a semantic version
format (0.1.0, 1.0.0, etc.). This is a common practice for deploying
packages, as it allows us to control when a new version of our package
is released.</p>
<p>Let’s create a new tag and push it to our repository. You can do this
using the following commands:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">git</span> tag 0.1.0</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">git</span> push <span class="at">--tags</span></span></code></pre>
</div>
<p>Looking back at the “Actions” tab, you should see that your workflow
has started running! Our project is pretty small, so it should finish
quickly. Clicking on the workflow will show you the steps that were
executed:</p>
<figure><img src="./fig/08-building-and-deploying/sucessfull_build.jpg" alt="GitHub Actions Successful Build" class="figure mx-auto d-block"><div class="figcaption">GitHub Actions Running</div>
</figure><p>You can see the “Setup Python”, “Install uv”, “Build Package”, and
“Upload Artifacts” steps that we defined in our <code>build.yml</code>
file, as well as some additional steps before and after that GitHub
automatically adds. If everything went well, you should see a green
check mark next to each step.</p>
<p>Clicking on any given job will give some additional details,
including the console output.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Github Actions is free for public repositories, but does have limits
on the amount of compute time you can use per month. As of September
2025, the limit is 2,000 minutes per month. This is generally more than
enough for most open source projects.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="finding-the-built-package">Finding the Built Package<a class="anchor" aria-label="anchor" href="#finding-the-built-package"></a>
</h3>
<p>So our workflow is successful, but where is our package? Our little
script actually put our project in three places:</p>
<ul>
<li>As an artifact in our GitHub repository for this workflow run</li>
<li>As a release in our GitHub repository</li>
<li>On TestPyPI as a package</li>
</ul>
<p>The Artifact can be found in the “Actions” tab, by clicking on the
workflow run, and then clicking on the “Artifacts” section on the right
side of the page. You can download the artifact as a ZIP file, which
contains the <code>dist/</code> directory with our built package files.
(This is identical to what we built locally earlier.)</p>
<p>The Release can be found by clicking on the “Releases” link on the
right side of your GitHub repository page. You should see a new release
with the tag <code>0.1.0</code>, and the built package files attached as
assets.</p>
<p>Finally, the package can be found on TestPyPI by going to <a href="https://test.pypi.org/project/textanalysis-tool-%7Bmy-name%7D/" class="external-link uri">https://test.pypi.org/project/textanalysis-tool-{my-name}/</a>.</p>
</div>
</section><section><h2 class="section-heading" id="installing-our-package-from-testpypi">Installing our package from TestPyPI<a class="anchor" aria-label="anchor" href="#installing-our-package-from-testpypi"></a>
</h2>
<hr class="half-width">
<p>Now that our package is published on TestPyPI, we can install it into
any Python environment using a package manager. Because we are using
test.pypi.org, we need to specify the index URL when installing the
package, which we do not have to do for packages on the main PyPI
repository.</p>
<p>Create a new virtual environment in a clean folder with uv:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">uv</span> init</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">uv</span> venv</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">uv</span> activate</span></code></pre>
</div>
<p>Then install our package from TestPyPI using pip:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">uv</span> pip install <span class="at">--index-url</span> https://test.pypi.org/simple/ textanalysis-tool-{my-name}</span></code></pre>
</div>
<p>You should see output indicating that pip is downloading and
installing our package. Once the installation is complete, you can
verify that the package is installed by running:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">uv</span> pip show textanalysis-tool-{my-name}</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="continuous-integration-continuous-deployment-cicd">Continuous Integration / Continuous Deployment (CI/CD)<a class="anchor" aria-label="anchor" href="#continuous-integration-continuous-deployment-cicd"></a>
</h2>
<hr class="half-width">
<p>One of the advantages of using an automated process like GitHub
Actions is that we can also easily add additional steps to our workflow.
In previous episodes, we have added unit tests to our project, as well
as static code analysis using <code>ruff</code> and <code>mypy</code>.
We can easily add these steps to our workflow to ensure that our code is
always tested and checked before it is built and deployed.</p>
<p>Here’s the updated <code>build.yml</code> file with the additional
steps:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Deploy Package</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'[0-9]+.[0-9]+.[0-9]+*'</span><span class="co"> # Deploy when we tag with a semantic version</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span><span class="co"> # Use the most up-to-date Ubuntu runner</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> write</span><span class="co">  # Required to create releases</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span><span class="co"> # Check out the repository</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">    # Create a Python environment</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Python</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v4</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="at">        </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.11'</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">    # Install uv</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install uv</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> astral-sh/setup-uv@v3</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">    # Install project with dev dependencies</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv sync --dev</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">    # Static Code Analysis with ruff</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run ruff</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv run ruff check .</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co">    # Type Checking with mypy</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run mypy</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv run mypy src</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="co">    # Running Tests with pytest</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv run pytest tests</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">    # Build the package</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Package</span></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv build</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a><span class="co">    # Upload the built package to the repository as an artifact</span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Upload Artifacts</span></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v4</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> textanalysis-tool</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> dist/</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a><span class="co">    # Create GitHub Release with artifacts</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Create Release</span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> softprops/action-gh-release@v1</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="at">        </span><span class="fu">files</span><span class="kw">:</span><span class="at"> dist/*</span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a><span class="at">        </span><span class="fu">generate_release_notes</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a><span class="at">        </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a><span class="co">    # Publish to TestPyPI</span></span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Publish to TestPyPI</span></span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a>        uv publish --publish-url https://test.pypi.org/legacy/ --username __token__ --password ${{ secrets.TEST_PYPI_API_TOKEN }}</span></code></pre>
</div>
<p>Update the version number in your <code>pyproject.toml</code> file to
<code>0.2.0</code>, and then create a new tag and push it to your
repository:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">git</span> tag 0.2.0</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">git</span> push <span class="at">--tags</span></span></code></pre>
</div>
<p>Now, unless you already went through in the earlier episodes, you
will likely see that the <code>ruff</code> , <code>mypy</code>, or
<code>pytest</code> steps fail. This is great! It means that we have
caught issues in our code before they made it into a release! Only once
all the tests pass and the code checks are clean will the package be
built and deployed.</p>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>Making a new tag for each release is good practice, however there are
also occasions where you might want to run some of these jobs regularly
when merging in code, or on pushes to certain branches. This is possible
- there is an example of this in the <a href="">Workshop
Addendum</a>.</p>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1:</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/jonathan-hartman/python-intermediate-tool/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/jonathan-hartman/python-intermediate-tool/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/jonathan-hartman/python-intermediate-tool/" class="external-link">Source</a></p>
				<p><a href="https://github.com/jonathan-hartman/python-intermediate-tool/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://jonathan-hartman.github.io/python-intermediate-tool/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://jonathan-hartman.github.io/python-intermediate-tool/aio.html",
  "identifier": "https://jonathan-hartman.github.io/python-intermediate-tool/aio.html",
  "dateCreated": "2025-08-23",
  "dateModified": "2025-09-16",
  "datePublished": "2025-09-16"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

